"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const index=require("./index-9c866aeb.js"),functions=require("./functions-77ef3f22.js"),fetch=require("./fetch-b673a242.js");require("./add-query-args-17c551b6.js");const scPaypalAddMethodCss=':host{display:block}.paypal-buttons{position:relative;line-height:0;text-align:center}.paypal-buttons:after{content:" ";border-bottom:1px solid var(--sc-input-border-color);width:100%;height:0;top:50%;left:0;right:0;position:absolute}',ScPaypalAddMethod=class{constructor(e){index.registerInstance(this,e),this.liveMode=!0}componentWillLoad(){this.createPaymentIntent()}async handlePaymentIntentCreate(){var e,t;const{external_intent_id:a}=this.paymentIntent||{},{client_id:n,account_id:r,merchant_initiated:i}=(null===(t=null===(e=this.paymentIntent)||void 0===e?void 0:e.processor_data)||void 0===t?void 0:t.paypal)||{};if(n&&r&&a&&!this.paypal)try{this.paypal=await functions.loadScript(functions.getScriptLoadParams({clientId:n,merchantId:r,merchantInitiated:i,reusable:!0})),this.paypal.Buttons({onInit:()=>{this.loaded=!0},createBillingAgreement:()=>new Promise((e=>e(a))),onApprove:async()=>{var e;try{this.loading=!0;const t=await fetch.apiFetch({method:"PATCH",path:`surecart/v1/payment_intents/${null===(e=this.paymentIntent)||void 0===e?void 0:e.id}/capture`});if(!["succeeded","pending","requires_approval"].includes(null==t?void 0:t.status))throw{message:wp.i18n.__("The payment did not process. Please try again.","surecart")};window.location.assign(this.successUrl)}catch(e){console.error(e),this.error=(null==e?void 0:e.message)||wp.i18n.__("The payment did not process. Please try again.","surecart"),this.loading=!1}},onError:e=>{console.error(e),alert((null==e?void 0:e.message)||wp.i18n.__("The payment did not process. Please try again.","surecart"))}}).render(this.container)}catch(e){console.error("Failed to load the PayPal JS SDK script",e),this.error=wp.i18n.__("Failed to load the PayPal JS SDK script","surecart")}}async createPaymentIntent(){var e,t;try{this.loading=!0,this.error="",this.paymentIntent=await fetch.apiFetch({method:"POST",path:"surecart/v1/payment_intents",data:{processor_type:"paypal",reusable:!0,live_mode:this.liveMode,customer_id:this.customerId,currency:this.currency}})}catch(a){this.error=(null===(t=null===(e=null==a?void 0:a.additional_errors)||void 0===e?void 0:e[0])||void 0===t?void 0:t.message)||(null==a?void 0:a.message)||wp.i18n.__("Something went wrong","surecart")}finally{this.loading=!1}}render(){return index.h(index.Host,null,this.error&&index.h("sc-alert",{open:!!this.error,type:"danger"},index.h("span",{slot:"title"},wp.i18n.__("Error","surecart")),this.error),index.h("div",{class:"sc-paypal-button-container",hidden:!this.loaded,ref:e=>this.container=e}))}static get watchers(){return{paymentIntent:["handlePaymentIntentCreate"]}}};ScPaypalAddMethod.style=scPaypalAddMethodCss,exports.sc_paypal_add_method=ScPaypalAddMethod;