import{Component,Event,h,Prop,State,Watch}from"@stencil/core";import{__}from"@wordpress/i18n";import{isRtl}from"../../../functions/page-align";import{getHumanDiscount}from"../../../functions/price";export class ScCouponForm{handleOpenChange(e){e&&setTimeout((()=>this.input.triggerFocus()),50)}handleBlur(){this.value||(this.open=!1,this.error="")}applyCoupon(){this.scApplyCoupon.emit(this.input.value.toUpperCase())}handleKeyDown(e){"Enter"===(null==e?void 0:e.code)&&this.applyCoupon()}render(){var e,t,o,r,s,n,l;if(this.loading)return h("sc-skeleton",{style:{width:"120px",display:"inline-block"}});if(null===(t=null===(e=null==this?void 0:this.discount)||void 0===e?void 0:e.promotion)||void 0===t?void 0:t.code){let e="";return(null===(o=null==this?void 0:this.discount)||void 0===o?void 0:o.coupon)&&(null===(r=null==this?void 0:this.discount)||void 0===r?void 0:r.coupon.percent_off)&&(e=getHumanDiscount(null===(s=null==this?void 0:this.discount)||void 0===s?void 0:s.coupon)),h("sc-line-item",{exportparts:"description:info, price-description:discount, price:amount"},h("span",{slot:"description"},h("div",{part:"discount-label"},__("Discount","surecart")),h("sc-tag",{exportparts:"base:coupon-tag",type:"success",class:"coupon-tag",clearable:!0,onScClear:()=>{this.scApplyCoupon.emit(null),this.open=!1}},null===(l=null===(n=null==this?void 0:this.discount)||void 0===n?void 0:n.promotion)||void 0===l?void 0:l.code)),e&&h("span",{class:"coupon-human-discount",slot:"price-description"},"(",e,")"),h("span",{slot:"price"},h("sc-format-number",{type:"currency",currency:null==this?void 0:this.currency,value:null==this?void 0:this.discountAmount})))}return this.collapsed?h("div",{part:"base",class:{"coupon-form":!0,"coupon-form--is-open":this.open||this.forceOpen,"coupon-form--has-value":!!this.value,"coupon-form--is-rtl":isRtl()}},h("div",{part:"label",class:"trigger",onMouseDown:()=>{this.open||(this.open=!0)}},h("slot",{name:"label"},this.label)),h("div",{class:"form",part:"form"},h("sc-input",{exportparts:"base:input__base, input, form-control:input__form-control",value:this.value,onScInput:e=>this.value=e.target.value,placeholder:this.placeholder,onScBlur:()=>this.handleBlur(),onKeyDown:e=>this.handleKeyDown(e),ref:e=>this.input=e},h("sc-button",{exportparts:"base:button__base, label:button_label",slot:"suffix",type:"text",loading:this.busy,size:"medium",class:"coupon-button",onClick:()=>this.applyCoupon()},h("slot",null,this.buttonText))),h("sc-button",{exportparts:"base:button__base, label:button_label",type:"primary",outline:!0,loading:this.busy,size:"medium",class:"coupon-button-mobile",onClick:()=>this.applyCoupon()},h("slot",null,this.buttonText)),!!this.error&&h("sc-alert",{exportparts:"base:error__base, icon:error__icon, text:error__text, title:error_title, message:error__message",type:"danger",open:!0},h("span",{slot:"title"},this.error))),this.loading&&h("sc-block-ui",{exportparts:"base:block-ui, content:block-ui__content"})):h("sc-form-control",{label:this.label,class:{"coupon-form":!0,"coupon-form--has-value":!!this.value,"coupon-form--is-rtl":isRtl()}},h("sc-input",{exportparts:"base:input__base, input, form-control:input__form-control",value:this.value,onScInput:e=>this.value=e.target.value,placeholder:this.placeholder,onScBlur:()=>this.handleBlur(),onKeyDown:e=>this.handleKeyDown(e),ref:e=>this.input=e},h("sc-button",{exportparts:"base:button__base, label:button_label",slot:"suffix",type:"text",loading:this.busy,size:"medium",class:"coupon-button",onClick:()=>this.applyCoupon()},h("slot",null))),!!this.error&&h("sc-alert",{exportparts:"base:error__base, icon:error__icon, text:error__text, title:error_title, message:error__message",type:"danger",open:!0},h("span",{slot:"title"},this.error)))}static get is(){return"sc-coupon-form"}static get encapsulation(){return"shadow"}static get originalStyleUrls(){return{$:["sc-coupon-form.scss"]}}static get styleUrls(){return{$:["sc-coupon-form.css"]}}static get properties(){return{label:{type:"string",mutable:!1,complexType:{original:"string",resolved:"string",references:{}},required:!1,optional:!1,docs:{tags:[],text:"The label for the coupon form"},attribute:"label",reflect:!1},loading:{type:"boolean",mutable:!1,complexType:{original:"boolean",resolved:"boolean",references:{}},required:!1,optional:!1,docs:{tags:[],text:"Is the form loading"},attribute:"loading",reflect:!1},busy:{type:"boolean",mutable:!1,complexType:{original:"boolean",resolved:"boolean",references:{}},required:!1,optional:!1,docs:{tags:[],text:"Is the form calculating"},attribute:"busy",reflect:!1},placeholder:{type:"string",mutable:!1,complexType:{original:"string",resolved:"string",references:{}},required:!1,optional:!1,docs:{tags:[],text:"The placeholder for the input"},attribute:"placeholder",reflect:!1},error:{type:"string",mutable:!0,complexType:{original:"string",resolved:"string",references:{}},required:!1,optional:!1,docs:{tags:[],text:"The error message"},attribute:"error",reflect:!1},forceOpen:{type:"boolean",mutable:!1,complexType:{original:"boolean",resolved:"boolean",references:{}},required:!1,optional:!1,docs:{tags:[],text:"Force the form to show"},attribute:"force-open",reflect:!1},discount:{type:"unknown",mutable:!1,complexType:{original:"DiscountResponse",resolved:"DiscountResponse",references:{DiscountResponse:{location:"import",path:"../../../types"}}},required:!1,optional:!1,docs:{tags:[],text:"The discount"}},currency:{type:"string",mutable:!1,complexType:{original:"string",resolved:"string",references:{}},required:!1,optional:!1,docs:{tags:[],text:"Currency"},attribute:"currency",reflect:!1},discountAmount:{type:"number",mutable:!1,complexType:{original:"number",resolved:"number",references:{}},required:!1,optional:!1,docs:{tags:[],text:"The discount amount"},attribute:"discount-amount",reflect:!1},open:{type:"boolean",mutable:!0,complexType:{original:"boolean",resolved:"boolean",references:{}},required:!1,optional:!1,docs:{tags:[],text:"Is it open"},attribute:"open",reflect:!1},collapsed:{type:"boolean",mutable:!1,complexType:{original:"boolean",resolved:"boolean",references:{}},required:!1,optional:!1,docs:{tags:[],text:""},attribute:"collapsed",reflect:!1},buttonText:{type:"string",mutable:!1,complexType:{original:"string",resolved:"string",references:{}},required:!1,optional:!1,docs:{tags:[],text:"The text for apply button"},attribute:"button-text",reflect:!0}}}static get states(){return{value:{}}}static get events(){return[{method:"scApplyCoupon",name:"scApplyCoupon",bubbles:!0,cancelable:!0,composed:!0,docs:{tags:[],text:"When the coupon is applied"},complexType:{original:"string",resolved:"string",references:{}}}]}static get watchers(){return[{propName:"open",methodName:"handleOpenChange"}]}}