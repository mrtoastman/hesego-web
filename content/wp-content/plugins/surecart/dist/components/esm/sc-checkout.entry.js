import{r as registerInstance,c as createEvent,h,g as getElement}from"./index-fd4790f6.js";import{a as state}from"./watchers-0c79cf4e.js";import"./watchers-0c38e1b1.js";import{s as state$1}from"./getters-c6fb954d.js";import{s as state$2}from"./store-3645d641.js";import{U as Universe}from"./universe-e944e399.js";import"./index-26bbcef3.js";import"./add-query-args-f4c5962b.js";import"./watchers-e86a5dda.js";import"./util-1396ff7b.js";const scCheckoutCss="sc-checkout{display:block;font-family:var(--sc-font-sans);font-size:var(--sc-checkout-font-size, 16px);position:relative}sc-checkout h3{font-size:var(--sc-input-label-font-size-medium)}sc-alert{margin-bottom:var(--sc-form-row-spacing)}.sc-checkout-container.sc-align-center{max-width:500px;margin-left:auto;margin-right:auto}.sc-checkout-container.sc-align-wide{max-width:800px;margin-left:auto;margin-right:auto}::slotted(*){font-family:var(--sc-font-sans)}",ScCheckout=class{constructor(t){registerInstance(this,t),this.scOrderUpdated=createEvent(this,"scOrderUpdated",7),this.scOrderFinalized=createEvent(this,"scOrderFinalized",7),this.scOrderError=createEvent(this,"scOrderError",7),this.prices=[],this.mode="live",this.currencyCode="usd",this.persistSession=!0,this.successUrl="",this.editLineItems=!0,this.removeLineItems=!0,this.stripePaymentElement=!1,this.pricesEntities={},this.productsEntities={},this.checkoutState="idle",this.processor="stripe",this.paymentIntents={}}handleOrderStateUpdate(t){state.checkout=t.detail}handleMethodChange(t){this.method=t.detail}handleAddEntities(t){const{products:e,prices:s}=t.detail;Object.keys((null==e?void 0:e.length)||{})&&(this.productsEntities={...this.productsEntities,...e}),Object.keys((null==s?void 0:s.length)||{})&&(this.pricesEntities={...this.pricesEntities,...s})}async submit({skip_validation:t}={skip_validation:!1}){return t||await this.validate(),await this.sessionProvider.finalize()}async validate(){const t=this.el.querySelector("sc-form");return await t.validate()}componentWillLoad(){const t=document.querySelector("sc-checkout");this.isDuplicate=!!t&&t!==this.el,this.isDuplicate||(Universe.create(this,this.state()),state$1.processors=this.processors,state$1.manualPaymentMethods=this.manualPaymentMethods,state$1.config.stripe.paymentElement=this.stripePaymentElement,state.formId=this.formId,state.mode=this.mode,state.product=this.product||null,state.currencyCode=this.currencyCode,state.groupId=this.el.id,state.abandonedCheckoutReturnUrl=this.abandonedCheckoutReturnUrl)}state(){var t,e,s,i,o,a,r,n,c,d,l,u,h,m,p,v,g,f,k,y,b,_x;return{processor:this.processor,method:this.method,selectedProcessorId:this.processor,manualPaymentMethods:this.manualPaymentMethods,processor_data:null===(t=state.checkout)||void 0===t?void 0:t.processor_data,state:this.checkoutState,formState:state$2.formState.value,paymentIntents:this.paymentIntents,successUrl:this.successUrl,bumps:null===(s=null===(e=state.checkout)||void 0===e?void 0:e.recommended_bumps)||void 0===s?void 0:s.data,order:state.checkout,abandonedCheckoutEnabled:null===(i=state.checkout)||void 0===i?void 0:i.abandoned_checkout_enabled,checkout:state.checkout,shippingEnabled:null===(o=state.checkout)||void 0===o?void 0:o.shipping_enabled,lineItems:(null===(r=null===(a=state.checkout)||void 0===a?void 0:a.line_items)||void 0===r?void 0:r.data)||[],editLineItems:this.editLineItems,removeLineItems:this.removeLineItems,loading:"loading"===state$2.formState.value,busy:["updating","finalizing","paying","confirming"].includes(state$2.formState.value),paying:["finalizing","paying","confirming"].includes(state$2.formState.value),empty:!["loading","updating"].includes(state$2.formState.value)&&!(null===(d=null===(c=null===(n=state.checkout)||void 0===n?void 0:n.line_items)||void 0===c?void 0:c.pagination)||void 0===d?void 0:d.count),stripePaymentElement:this.stripePaymentElement,stripePaymentIntent:((null===(u=null===(l=state.checkout)||void 0===l?void 0:l.staged_payment_intents)||void 0===u?void 0:u.data)||[]).find((t=>"stripe"===t.processor_type)),error:this.error,customer:this.customer,tax_status:null===(h=state.checkout)||void 0===h?void 0:h.tax_status,taxEnabled:null===(m=state.checkout)||void 0===m?void 0:m.tax_enabled,customerShippingAddress:"string"!=typeof(null===(p=state.checkout)||void 0===p?void 0:p.customer)?null===(g=null===(v=state.checkout)||void 0===v?void 0:v.customer)||void 0===g?void 0:g.shipping_address:{},shippingAddress:null===(f=state.checkout)||void 0===f?void 0:f.shipping_address,taxStatus:null===(k=state.checkout)||void 0===k?void 0:k.tax_status,taxIdentifier:null===(y=state.checkout)||void 0===y?void 0:y.tax_identifier,totalAmount:null===(b=state.checkout)||void 0===b?void 0:b.total_amount,taxProtocol:this.taxProtocol,lockedChoices:this.prices,products:this.productsEntities,prices:this.pricesEntities,country:"US",loggedIn:this.loggedIn,emailExists:null===(_x=state.checkout)||void 0===_x?void 0:_x.email_exists,formId:this.formId,mode:this.mode,currencyCode:this.currencyCode}}render(){var t,e,s,i;return this.isDuplicate?h("sc-alert",{open:!0},wp.i18n.__("Due to processor restrictions, only one checkout form is allowed on the page.","surecart")):h("div",{class:{"sc-checkout-container":!0,"sc-align-center":"center"===this.alignment,"sc-align-wide":"wide"===this.alignment,"sc-align-full":"full"===this.alignment}},h("sc-checkout-unsaved-changes-warning",{state:this.checkoutState}),h(Universe.Provider,{state:this.state()},h("sc-login-provider",{loggedIn:this.loggedIn,onScSetCustomer:t=>this.customer=t.detail,onScSetLoggedIn:t=>this.loggedIn=t.detail,order:state.checkout},h("sc-form-state-provider",{onScSetCheckoutFormState:t=>this.checkoutState=t.detail},h("sc-form-error-provider",{checkoutState:state$2.formState.value,onScUpdateError:t=>this.error=t.detail},h("sc-form-components-validator",{order:state.checkout,disabled:this.disableComponentsValidation,taxProtocol:this.taxProtocol},h("sc-order-confirm-provider",{"success-url":this.successUrl,successText:this.successText},h("sc-session-provider",{ref:t=>this.sessionProvider=t,prices:this.prices,persist:this.persistSession,onScError:t=>this.error=t.detail},h("slot",null))))))),this.state().busy&&h("sc-block-ui",{class:"busy-block-ui","z-index":30}),"finalizing"===state$2.formState.value&&h("sc-block-ui",{"z-index":30,spinner:!0,style:{"--sc-block-ui-opacity":"0.75"}},(null===(t=this.loadingText)||void 0===t?void 0:t.finalizing)||wp.i18n.__("Submitting order...","surecart")),"paying"===state$2.formState.value&&h("sc-block-ui",{"z-index":30,spinner:!0,style:{"--sc-block-ui-opacity":"0.75"}},(null===(e=this.loadingText)||void 0===e?void 0:e.paying)||wp.i18n.__("Processing payment...","surecart")),"confirming"===state$2.formState.value&&h("sc-block-ui",{"z-index":30,spinner:!0,style:{"--sc-block-ui-opacity":"0.75"}},(null===(s=this.loadingText)||void 0===s?void 0:s.confirming)||wp.i18n.__("Finalizing order...","surecart")),"redirecting"===state$2.formState.value&&h("sc-block-ui",{"z-index":30,spinner:!0,style:{"--sc-block-ui-opacity":"0.75"}},(null===(i=this.loadingText)||void 0===i?void 0:i.confirmed)||wp.i18n.__("Success! Redirecting...","surecart"))))}get el(){return getElement(this)}};ScCheckout.style=scCheckoutCss;export{ScCheckout as sc_checkout};