"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const index=require("./index-9c866aeb.js"),address=require("./address-23549efd.js"),formData=require("./form-data-9342e967.js"),consumer=require("./consumer-3f5ce850.js"),index$1=require("./index-cf22257b.js"),price=require("./price-d3e21aa4.js"),watchers=require("./watchers-203d7acd.js"),mutations=require("./mutations-5cf514b3.js"),index$2=require("./index-2840f0ff.js");require("./index-f6f80680.js"),require("./add-query-args-17c551b6.js"),require("./watchers-be62d6ad.js"),require("./watchers-d5742848.js"),require("./getters-c6087113.js"),require("./util-98cb3494.js"),require("./fetch-b673a242.js"),require("./get-query-arg-53bf21e2.js");const scCompactAddressCss=":host{display:block}.sc-address{display:block;position:relative}.sc-address [hidden]{display:none}.sc-address--loading{min-height:70px}.sc-address--loading sc-skeleton{display:block;margin-bottom:1em}.sc-address__control{display:block}.sc-address__control>*{margin-bottom:-1px}.sc-address__columns{display:flex;flex-direction:row;align-items:center;flex-wrap:wrap;justify-content:space-between}.sc-address__columns>*{flex:1;width:50%;margin-left:-1px}.sc-address__columns>*:first-child{margin-left:0}",ScCompactAddress=class{constructor(e){index.registerInstance(this,e),this.scChangeAddress=index.createEvent(this,"scChangeAddress",7),this.scInputAddress=index.createEvent(this,"scInputAddress",7),this.address={country:null,city:null,line_1:null,line_2:null,postal_code:null,state:null},this.names={country:"shipping_country",city:"shipping_city",line_1:"shipping_line_1",line_2:"shipping_line_2",postal_code:"shipping_postal_code",state:"shipping_state"},this.placeholders={country:"",postal_code:"",state:""},this.label=wp.i18n.__("Country or region","surecart"),this.countryChoices=address.countryChoices}handleAddressChange(){this.address.country&&(this.setRegions(),this.showState=["US","CA"].includes(this.address.country),this.showPostal=["US"].includes(this.address.country),this.scChangeAddress.emit(this.address),this.scInputAddress.emit(this.address))}updateAddress(e){this.address={...this.address,...e}}handleAddressInput(e){this.scInputAddress.emit({...this.address,...e})}clearAddress(){this.address={country:null,line_1:null,line_2:null,city:null,postal_code:null,state:null}}setRegions(){address.hasState(this.address.country)?Promise.resolve().then((function(){return require("./countries-0ec7ecdc.js")})).then((e=>{this.regions=null==e?void 0:e[this.address.country]})):this.regions=[]}componentWillLoad(){var e;this.handleAddressChange();const s=null===(e=this.countryChoices.find((e=>e.value===this.address.country)))||void 0===e?void 0:e.value;s&&this.updateAddress({country:s})}async reportValidity(){return formData.reportChildrenValidity(this.el)}getStatePlaceholder(){var e,s;return(null===(e=this.placeholders)||void 0===e?void 0:e.state)?this.placeholders.state:"US"===(null===(s=this.address)||void 0===s?void 0:s.country)?wp.i18n.__("State","surecart"):wp.i18n.__("Province/Region","surecart")}render(){var e,s,t,i,r;return index.h("div",{class:"sc-address",part:"base"},index.h("sc-form-control",{exportparts:"label, help-text, form-control",label:this.label,class:"sc-address__control",part:"control",required:this.required},index.h("sc-select",{exportparts:"base:select__base, input, form-control, label, help-text, trigger, panel, caret, search__base, search__input, search__form-control, menu__base, spinner__base, empty",value:null===(e=this.address)||void 0===e?void 0:e.country,onScChange:e=>{this.clearAddress(),this.updateAddress({country:e.target.value||null})},choices:this.countryChoices,autocomplete:"country-name",placeholder:(null===(s=this.placeholders)||void 0===s?void 0:s.country)||wp.i18n.__("Select Your Country","surecart"),name:this.names.country,search:!0,unselect:!1,"squared-bottom":this.showState||this.showPostal,required:this.required}),index.h("div",{class:"sc-address__columns"},this.showState&&index.h("sc-select",{exportparts:"base:select__base, input, form-control, label, help-text, trigger, panel, caret, search__base, search__input, search__form-control, menu__base, spinner__base, empty",placeholder:this.getStatePlaceholder(),name:this.names.state,autocomplete:"address-level1",value:null===(t=null==this?void 0:this.address)||void 0===t?void 0:t.state,onScChange:e=>this.updateAddress({state:e.target.value||null}),choices:this.regions,required:this.required,search:!0,"squared-top":!0,unselect:!1,"squared-right":this.showPostal}),this.showPostal&&index.h("sc-input",{exportparts:"base:input__base, input, form-control, label, help-text",placeholder:(null===(i=this.placeholders)||void 0===i?void 0:i.postal_code)||wp.i18n.__("Postal Code/Zip","surecart"),name:this.names.postal_code,onScChange:e=>this.updateAddress({postal_code:e.target.value||null}),onScInput:e=>this.handleAddressInput({name:e.target.value||null}),autocomplete:"postal-code",required:this.required,value:null===(r=null==this?void 0:this.address)||void 0===r?void 0:r.postal_code,"squared-top":!0,maxlength:5,"squared-left":this.showState}))),this.loading&&index.h("sc-block-ui",{exportparts:"base:block-ui, content:block-ui__content"}))}get el(){return index.getElement(this)}static get watchers(){return{address:["handleAddressChange"]}}};ScCompactAddress.style=scCompactAddressCss;const scLineItemTaxCss=":host{display:block}",ScLineItemTax=class{constructor(e){index.registerInstance(this,e)}renderLabel(){var e,s,t;let i=wp.i18n.sprintf(wp.i18n.__("Estimated %s","surecart"),(null===(e=null==this?void 0:this.order)||void 0===e?void 0:e.tax_label)||"");return"calculated"===(null===(s=null==this?void 0:this.order)||void 0===s?void 0:s.tax_status)&&(i=(null===(t=this.order)||void 0===t?void 0:t.tax_label)||""),index.h(index.Fragment,null,`${wp.i18n.__("Tax:","surecart")} ${i}`,this.renderPercent())}renderPercent(){var e;return(null===(e=this.order)||void 0===e?void 0:e.tax_percent)?index.h(index.Fragment,null,"(",this.order.tax_percent,"%",")"):""}render(){var e,s,t,i,r,d,n;return(null===(e=null==this?void 0:this.order)||void 0===e?void 0:e.tax_amount)?index.h("sc-line-item",null,index.h("span",{slot:"description"},this.renderLabel()),(null===(s=this.order)||void 0===s?void 0:s.tax_exclusive_amount)&&index.h("span",{slot:"price"},index.h("sc-format-number",{type:"currency",currency:(null===(t=null==this?void 0:this.order)||void 0===t?void 0:t.currency)||"usd",value:null===(i=null==this?void 0:this.order)||void 0===i?void 0:i.tax_exclusive_amount})),(null===(r=this.order)||void 0===r?void 0:r.tax_inclusive_amount)&&index.h("span",{slot:"price-description"},"(",index.h("sc-format-number",{type:"currency",currency:(null===(d=null==this?void 0:this.order)||void 0===d?void 0:d.currency)||"usd",value:null===(n=null==this?void 0:this.order)||void 0===n?void 0:n.tax_inclusive_amount})," ",wp.i18n.__("included","surecart"),")")):null}};consumer.openWormhole(ScLineItemTax,["order","loading"],!1),ScLineItemTax.style=scLineItemTaxCss;const scOrderBumpCss=":host{display:block}.bump{display:grid;gap:1em}.bump__text{display:grid;gap:0.25em}.bump__tag{background:var(--sc-color-primary-500);color:var(--sc-color-white);border-radius:var(--sc-input-border-radius-medium);padding:var(--sc-spacing-x-small);font-size:var(--sc-font-size-x-small)}.bump__product{display:flex;align-items:center;gap:var(--sc-choice-padding, 1.3em 1.1em);line-height:var(--sc-line-height-dense)}.bump__product-title{font-weight:var(--sc-font-weight-semibold)}.bump__product-description{color:var(--sc-input-label-color)}.bump__image{width:var(--sc-product-line-item-image-size, 4em);height:var(--sc-product-line-item-image-size, 4em);flex:0 0 var(--sc-product-line-item-image-size, 4em);object-fit:cover;border-radius:4px;border:1px solid var(--sc-color-gray-200);display:block;box-shadow:var(--sc-input-box-shadow)}.bump__price--has-discount .bump__original-price{text-decoration:line-through;color:var(--sc-color-gray-500);font-size:var(--sc-font-size-small)}.bump__price .bump__new-price{font-size:var(--sc-font-size-large);color:var(--sc-color-gray-700)}.bump__price .bump__interval{color:var(--sc-color-gray-500)}.bump__amount{display:flex;align-items:center;gap:var(--sc-spacing-x-small);flex-wrap:wrap;margin-top:var(--sc-spacing-xx-small)}",ScOrderBump=class{constructor(e){index.registerInstance(this,e),this.scAddLineItem=index.createEvent(this,"scAddLineItem",7),this.scRemoveLineItem=index.createEvent(this,"scRemoveLineItem",7)}updateLineItem(e){var s,t,i;const r=(null===(s=this.bump.price)||void 0===s?void 0:s.id)||(null===(t=this.bump)||void 0===t?void 0:t.price);e?this.scAddLineItem.emit({bump:null===(i=this.bump)||void 0===i?void 0:i.id,price_id:r,quantity:1}):this.scRemoveLineItem.emit({price_id:r,quantity:1})}newPrice(){var e,s,t,i,r,d;let n=null,a=(null===(s=null===(e=this.bump)||void 0===e?void 0:e.price)||void 0===s?void 0:s.amount)||0;if((null===(t=this.bump)||void 0===t?void 0:t.amount_off)&&(n=Math.max(0,a-(null===(i=this.bump)||void 0===i?void 0:i.amount_off))),null===(r=this.bump)||void 0===r?void 0:r.percent_off){const e=a*((null===(d=this.bump)||void 0===d?void 0:d.percent_off)/100);n=Math.max(0,a-e)}return n}renderInterval(){var e;const s=price.intervalString(null===(e=this.bump)||void 0===e?void 0:e.price,{labels:{interval:"/",period:wp.i18n.__("for","surecart")}});return s.trim().length?index.h("span",{class:"bump__interval"},s):null}renderPrice(){var e,s,t,i,r,d,n;return index.h("div",{slot:"description",class:{bump__price:!0,"bump__price--has-discount":!!(null===(e=this.bump)||void 0===e?void 0:e.percent_off)||!!(null===(s=this.bump)||void 0===s?void 0:s.amount_off)},part:"price"},index.h("sc-format-number",{type:"currency",class:"bump__original-price",value:null===(i=null===(t=this.bump)||void 0===t?void 0:t.price)||void 0===i?void 0:i.amount,currency:null===(d=null===(r=this.bump)||void 0===r?void 0:r.price)||void 0===d?void 0:d.currency})," ",0===this.newPrice()&&wp.i18n.__("Free","surecart"),null!==this.newPrice()&&this.newPrice()>0&&index.h("sc-format-number",{type:"currency",class:"bump__new-price",value:this.newPrice(),currency:(null===(n=this.bump)||void 0===n?void 0:n.price).currency}),this.renderInterval())}renderDiscount(){var e,s,t,i,r;return(null===(e=this.bump)||void 0===e?void 0:e.amount_off)?index.h("div",{class:"bump__tag"},wp.i18n.__("Save","surecart")," ",index.h("sc-format-number",{type:"currency",value:-(null===(s=this.bump)||void 0===s?void 0:s.amount_off),currency:(null===(t=this.bump)||void 0===t?void 0:t.price).currency})):(null===(i=this.bump)||void 0===i?void 0:i.percent_off)?index.h("div",{class:"bump__tag"},wp.i18n.sprintf(wp.i18n.__("Save %s%%","surecart"),null===(r=this.bump)||void 0===r?void 0:r.percent_off)):void 0}render(){var e,s,t,i,r,d,n,a,o,l,c,u,h,p;const m=null===(s=null===(e=this.bump)||void 0===e?void 0:e.price)||void 0===s?void 0:s.product;return index.h("sc-choice",{value:null===(t=this.bump)||void 0===t?void 0:t.id,type:"checkbox",showControl:this.showControl,checked:index$1.isBumpInOrder(this.bump,this.checkout),onScChange:e=>this.updateLineItem(e.target.checked),exportparts:"base, control, checked-icon, title"},index.h("div",{part:"base-content",class:"bump"},index.h("div",{class:"bump__text"},index.h("div",{class:"bump__title"},(null===(r=null===(i=this.bump)||void 0===i?void 0:i.metadata)||void 0===r?void 0:r.cta)||(null===(d=this.bump)||void 0===d?void 0:d.name)||(null==m?void 0:m.name)),index.h("div",{class:"bump__amount"},this.renderPrice()," ",this.renderDiscount()))),(null===(a=null===(n=this.bump)||void 0===n?void 0:n.metadata)||void 0===a?void 0:a.description)&&index.h("div",{slot:"footer"},index.h("sc-divider",{style:{"--spacing":"var(--sc-spacing-medium)"}}),index.h("div",{class:"bump__product"},!!(null==m?void 0:m.image_url)&&index.h("img",{src:m.image_url,class:"bump__image"}),index.h("div",{class:"bump__product-text"},!!(null===(l=null===(o=this.bump)||void 0===o?void 0:o.metadata)||void 0===l?void 0:l.cta)&&index.h("div",{class:"bump__product-title"},this.bump.name||(null==m?void 0:m.name)),!!(null===(u=null===(c=this.bump)||void 0===c?void 0:c.metadata)||void 0===u?void 0:u.description)&&index.h("div",{class:"bump__product-description"},null===(p=null===(h=this.bump)||void 0===h?void 0:h.metadata)||void 0===p?void 0:p.description)))))}};ScOrderBump.style=scOrderBumpCss;const scOrderBumpsCss=":host{display:block}.bumps__list{display:grid;gap:10px}",ScOrderBumps=class{constructor(e){index.registerInstance(this,e)}render(){var e;return(null===(e=null==this?void 0:this.bumps)||void 0===e?void 0:e.length)?index.h("sc-form-control",{label:this.label||wp.i18n.__("Recommended","surecart"),help:this.help},index.h("div",{class:"bumps__list"},(this.bumps||[]).map((e=>index.h("sc-order-bump",{key:null==e?void 0:e.id,showControl:this.showControl,bump:e,checkout:this.checkout}))))):null}};consumer.openWormhole(ScOrderBumps,["bumps","checkout"],!1),ScOrderBumps.style=scOrderBumpsCss;const scOrderShippingAddressCss=":host{display:block}.sc-order-shipping__loading{display:flex;flex-direction:column;gap:0.5em}",ScOrderShippingAddress=class{constructor(e){index.registerInstance(this,e),this.scUpdateOrder=index.createEvent(this,"scUpdateOrder",7),this.required=!1,this.namePlaceholder=wp.i18n.__("Name or Company Name","surecart"),this.countryPlaceholder=wp.i18n.__("Country","surecart"),this.cityPlaceholder=wp.i18n.__("City","surecart"),this.line1Placeholder=wp.i18n.__("Address","surecart"),this.line2Placeholder=wp.i18n.__("Address Line 2","surecart"),this.postalCodePlaceholder=wp.i18n.__("Postal Code/Zip","surecart"),this.statePlaceholder=wp.i18n.__("State/Province/Region","surecart"),this.placeholders={name:wp.i18n.__("Name or Company Name","surecart"),country:wp.i18n.__("Country","surecart"),city:wp.i18n.__("City","surecart"),line_1:wp.i18n.__("Address","surecart"),line_2:wp.i18n.__("Address Line 2","surecart"),postal_code:wp.i18n.__("Postal Code/Zip","surecart"),state:wp.i18n.__("State/Province/Region","surecart")},this.address={country:null,city:null,line_1:null,line_2:null,postal_code:null,state:null}}handleCustomerAddressChange(e,s){(null==e?void 0:e.id)&&!s&&(this.address={...this.address,...e})}async updateAddressState(e){if(JSON.stringify(e)!==JSON.stringify(this.address)){this.address=e;try{mutations.lockCheckout("shipping-address"),watchers.state.checkout=await index$2.createOrUpdateCheckout({id:watchers.state.checkout.id,data:{shipping_address:this.address}})}catch(e){console.error(e)}finally{mutations.unLockCheckout("shipping-address")}}}async reportValidity(){return this.input.reportValidity()}componentWillLoad(){this.defaultCountry&&!this.address.country&&(this.address.country=this.defaultCountry),this.handleRequirementChange()}handleRequirementChange(){(this.shippingEnabled||this.taxEnabled)&&(this.required=!0)}render(){return this.shippingEnabled||this.full?index.h("sc-address",{exportparts:"label, help-text, form-control, input__base, select__base, columns, search__base, menu__base",ref:e=>this.input=e,label:this.label||wp.i18n.__("Shipping Address","surecart"),placeholders:{name:this.namePlaceholder,country:this.countryPlaceholder,city:this.cityPlaceholder,line_1:this.line1Placeholder,line_2:this.line2Placeholder,postal_code:this.postalCodePlaceholder,state:this.statePlaceholder},required:this.required,loading:this.loading,address:this.address,"show-name":this.showName,onScChangeAddress:e=>this.updateAddressState(e.detail)}):index.h("sc-compact-address",{ref:e=>this.input=e,required:this.required,loading:this.loading,address:this.address,placeholders:{name:this.namePlaceholder,country:this.countryPlaceholder,city:this.cityPlaceholder,line_1:this.line1Placeholder,line_2:this.line2Placeholder,postal_code:this.postalCodePlaceholder,state:this.statePlaceholder},label:this.label,onScChangeAddress:e=>this.updateAddressState(e.detail)})}static get watchers(){return{shippingAddress:["handleCustomerAddressChange"],shippingEnabled:["handleRequirementChange"],taxEnabled:["handleRequirementChange"]}}};consumer.openWormhole(ScOrderShippingAddress,["shippingAddress","loading","taxStatus","taxEnabled","shippingEnabled"],!1),ScOrderShippingAddress.style=scOrderShippingAddressCss;const scOrderTaxIdInputCss=":host{display:block}",ScOrderTaxIdInput=class{constructor(e){index.registerInstance(this,e),this.scUpdateOrder=index.createEvent(this,"scUpdateOrder",7),this.scError=index.createEvent(this,"scError",7),this.show=!1,this.busy=!1}getStatus(){var e,s,t;return"eu_vat"!==(null===(e=this.taxIdentifier)||void 0===e?void 0:e.number_type)||"apply_reverse_charge"===(null===(s=this.taxProtocol)||void 0===s?void 0:s.eu_vat_unverified_behavior)?"unknown":(null===(t=this.taxIdentifier)||void 0===t?void 0:t.eu_vat_verified)?"valid":"invalid"}async maybeUpdateOrder(e){try{mutations.lockCheckout("tax_identifier"),watchers.state.checkout=await index$2.createOrUpdateCheckout({id:watchers.state.checkout.id,data:{tax_identifier:e}})}catch(e){console.error(e),this.scError.emit(e)}finally{mutations.unLockCheckout("tax_identifier")}}render(){var e,s,t,i,r,d;return index.h("sc-tax-id-input",{show:this.show,number:null===(s=null===(e=this.order)||void 0===e?void 0:e.tax_identifier)||void 0===s?void 0:s.number,type:null===(i=null===(t=this.order)||void 0===t?void 0:t.tax_identifier)||void 0===i?void 0:i.number_type,country:null===(d=null===(r=null==this?void 0:this.order)||void 0===r?void 0:r.shipping_address)||void 0===d?void 0:d.country,status:this.getStatus(),loading:this.busy,onScChange:e=>{e.stopImmediatePropagation(),this.maybeUpdateOrder(e.detail)},otherLabel:this.otherLabel,caGstLabel:this.caGstLabel,auAbnLabel:this.auAbnLabel,gbVatLabel:this.gbVatLabel,euVatLabel:this.euVatLabel})}};consumer.openWormhole(ScOrderTaxIdInput,["draft","order","tax_status","taxIdentifier","taxProtocol","busy"],!1),ScOrderTaxIdInput.style=scOrderTaxIdInputCss,exports.sc_compact_address=ScCompactAddress,exports.sc_line_item_tax=ScLineItemTax,exports.sc_order_bump=ScOrderBump,exports.sc_order_bumps=ScOrderBumps,exports.sc_order_shipping_address=ScOrderShippingAddress,exports.sc_order_tax_id_input=ScOrderTaxIdInput;