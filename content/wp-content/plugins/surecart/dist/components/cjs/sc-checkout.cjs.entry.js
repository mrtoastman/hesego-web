"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const index=require("./index-9c866aeb.js"),watchers=require("./watchers-203d7acd.js");require("./watchers-be62d6ad.js");const getters=require("./getters-c6087113.js"),store=require("./store-6708f186.js"),universe=require("./universe-28bdab41.js");require("./index-f6f80680.js"),require("./add-query-args-17c551b6.js"),require("./watchers-d5742848.js"),require("./util-98cb3494.js");const scCheckoutCss="sc-checkout{display:block;font-family:var(--sc-font-sans);font-size:var(--sc-checkout-font-size, 16px);position:relative}sc-checkout h3{font-size:var(--sc-input-label-font-size-medium)}sc-alert{margin-bottom:var(--sc-form-row-spacing)}.sc-checkout-container.sc-align-center{max-width:500px;margin-left:auto;margin-right:auto}.sc-checkout-container.sc-align-wide{max-width:800px;margin-left:auto;margin-right:auto}::slotted(*){font-family:var(--sc-font-sans)}",ScCheckout=class{constructor(e){index.registerInstance(this,e),this.scOrderUpdated=index.createEvent(this,"scOrderUpdated",7),this.scOrderFinalized=index.createEvent(this,"scOrderFinalized",7),this.scOrderError=index.createEvent(this,"scOrderError",7),this.prices=[],this.mode="live",this.currencyCode="usd",this.persistSession=!0,this.successUrl="",this.editLineItems=!0,this.removeLineItems=!0,this.stripePaymentElement=!1,this.pricesEntities={},this.productsEntities={},this.checkoutState="idle",this.processor="stripe",this.paymentIntents={}}handleOrderStateUpdate(e){watchers.state.checkout=e.detail}handleMethodChange(e){this.method=e.detail}handleAddEntities(e){const{products:t,prices:s}=e.detail;Object.keys((null==t?void 0:t.length)||{})&&(this.productsEntities={...this.productsEntities,...t}),Object.keys((null==s?void 0:s.length)||{})&&(this.pricesEntities={...this.pricesEntities,...s})}async submit({skip_validation:e}={skip_validation:!1}){return e||await this.validate(),await this.sessionProvider.finalize()}async validate(){const e=this.el.querySelector("sc-form");return await e.validate()}componentWillLoad(){const e=document.querySelector("sc-checkout");this.isDuplicate=!!e&&e!==this.el,this.isDuplicate||(universe.Universe.create(this,this.state()),getters.state.processors=this.processors,getters.state.manualPaymentMethods=this.manualPaymentMethods,getters.state.config.stripe.paymentElement=this.stripePaymentElement,watchers.state.formId=this.formId,watchers.state.mode=this.mode,watchers.state.product=this.product||null,watchers.state.currencyCode=this.currencyCode,watchers.state.groupId=this.el.id,watchers.state.abandonedCheckoutReturnUrl=this.abandonedCheckoutReturnUrl)}state(){var e,t,s,i,o,r,c,n,a,d,l,h,u,p,m,v,g,k,f,x,y,_x;return{processor:this.processor,method:this.method,selectedProcessorId:this.processor,manualPaymentMethods:this.manualPaymentMethods,processor_data:null===(e=watchers.state.checkout)||void 0===e?void 0:e.processor_data,state:this.checkoutState,formState:store.state.formState.value,paymentIntents:this.paymentIntents,successUrl:this.successUrl,bumps:null===(s=null===(t=watchers.state.checkout)||void 0===t?void 0:t.recommended_bumps)||void 0===s?void 0:s.data,order:watchers.state.checkout,abandonedCheckoutEnabled:null===(i=watchers.state.checkout)||void 0===i?void 0:i.abandoned_checkout_enabled,checkout:watchers.state.checkout,shippingEnabled:null===(o=watchers.state.checkout)||void 0===o?void 0:o.shipping_enabled,lineItems:(null===(c=null===(r=watchers.state.checkout)||void 0===r?void 0:r.line_items)||void 0===c?void 0:c.data)||[],editLineItems:this.editLineItems,removeLineItems:this.removeLineItems,loading:"loading"===store.state.formState.value,busy:["updating","finalizing","paying","confirming"].includes(store.state.formState.value),paying:["finalizing","paying","confirming"].includes(store.state.formState.value),empty:!["loading","updating"].includes(store.state.formState.value)&&!(null===(d=null===(a=null===(n=watchers.state.checkout)||void 0===n?void 0:n.line_items)||void 0===a?void 0:a.pagination)||void 0===d?void 0:d.count),stripePaymentElement:this.stripePaymentElement,stripePaymentIntent:((null===(h=null===(l=watchers.state.checkout)||void 0===l?void 0:l.staged_payment_intents)||void 0===h?void 0:h.data)||[]).find((e=>"stripe"===e.processor_type)),error:this.error,customer:this.customer,tax_status:null===(u=watchers.state.checkout)||void 0===u?void 0:u.tax_status,taxEnabled:null===(p=watchers.state.checkout)||void 0===p?void 0:p.tax_enabled,customerShippingAddress:"string"!=typeof(null===(m=watchers.state.checkout)||void 0===m?void 0:m.customer)?null===(g=null===(v=watchers.state.checkout)||void 0===v?void 0:v.customer)||void 0===g?void 0:g.shipping_address:{},shippingAddress:null===(k=watchers.state.checkout)||void 0===k?void 0:k.shipping_address,taxStatus:null===(f=watchers.state.checkout)||void 0===f?void 0:f.tax_status,taxIdentifier:null===(x=watchers.state.checkout)||void 0===x?void 0:x.tax_identifier,totalAmount:null===(y=watchers.state.checkout)||void 0===y?void 0:y.total_amount,taxProtocol:this.taxProtocol,lockedChoices:this.prices,products:this.productsEntities,prices:this.pricesEntities,country:"US",loggedIn:this.loggedIn,emailExists:null===(_x=watchers.state.checkout)||void 0===_x?void 0:_x.email_exists,formId:this.formId,mode:this.mode,currencyCode:this.currencyCode}}render(){var e,t,s,i;return this.isDuplicate?index.h("sc-alert",{open:!0},wp.i18n.__("Due to processor restrictions, only one checkout form is allowed on the page.","surecart")):index.h("div",{class:{"sc-checkout-container":!0,"sc-align-center":"center"===this.alignment,"sc-align-wide":"wide"===this.alignment,"sc-align-full":"full"===this.alignment}},index.h("sc-checkout-unsaved-changes-warning",{state:this.checkoutState}),index.h(universe.Universe.Provider,{state:this.state()},index.h("sc-login-provider",{loggedIn:this.loggedIn,onScSetCustomer:e=>this.customer=e.detail,onScSetLoggedIn:e=>this.loggedIn=e.detail,order:watchers.state.checkout},index.h("sc-form-state-provider",{onScSetCheckoutFormState:e=>this.checkoutState=e.detail},index.h("sc-form-error-provider",{checkoutState:store.state.formState.value,onScUpdateError:e=>this.error=e.detail},index.h("sc-form-components-validator",{order:watchers.state.checkout,disabled:this.disableComponentsValidation,taxProtocol:this.taxProtocol},index.h("sc-order-confirm-provider",{"success-url":this.successUrl,successText:this.successText},index.h("sc-session-provider",{ref:e=>this.sessionProvider=e,prices:this.prices,persist:this.persistSession,onScError:e=>this.error=e.detail},index.h("slot",null))))))),this.state().busy&&index.h("sc-block-ui",{class:"busy-block-ui","z-index":30}),"finalizing"===store.state.formState.value&&index.h("sc-block-ui",{"z-index":30,spinner:!0,style:{"--sc-block-ui-opacity":"0.75"}},(null===(e=this.loadingText)||void 0===e?void 0:e.finalizing)||wp.i18n.__("Submitting order...","surecart")),"paying"===store.state.formState.value&&index.h("sc-block-ui",{"z-index":30,spinner:!0,style:{"--sc-block-ui-opacity":"0.75"}},(null===(t=this.loadingText)||void 0===t?void 0:t.paying)||wp.i18n.__("Processing payment...","surecart")),"confirming"===store.state.formState.value&&index.h("sc-block-ui",{"z-index":30,spinner:!0,style:{"--sc-block-ui-opacity":"0.75"}},(null===(s=this.loadingText)||void 0===s?void 0:s.confirming)||wp.i18n.__("Finalizing order...","surecart")),"redirecting"===store.state.formState.value&&index.h("sc-block-ui",{"z-index":30,spinner:!0,style:{"--sc-block-ui-opacity":"0.75"}},(null===(i=this.loadingText)||void 0===i?void 0:i.confirmed)||wp.i18n.__("Success! Redirecting...","surecart"))))}get el(){return index.getElement(this)}};ScCheckout.style=scCheckoutCss,exports.sc_checkout=ScCheckout;