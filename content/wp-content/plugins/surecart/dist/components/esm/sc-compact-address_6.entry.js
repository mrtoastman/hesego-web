import{r as registerInstance,c as createEvent,h,g as getElement,F as Fragment}from"./index-fd4790f6.js";import{c as countryChoices,h as hasState}from"./address-c40a6eb5.js";import{r as reportChildrenValidity}from"./form-data-2d60f23e.js";import{o as openWormhole}from"./consumer-b5087188.js";import{a as isBumpInOrder}from"./index-1ef9aa85.js";import{i as intervalString}from"./price-a4ea8b5f.js";import{a as state}from"./watchers-0c79cf4e.js";import{l as lockCheckout,u as unLockCheckout}from"./mutations-8030ef46.js";import{c as createOrUpdateCheckout}from"./index-93eba176.js";import"./index-26bbcef3.js";import"./add-query-args-f4c5962b.js";import"./watchers-0c38e1b1.js";import"./watchers-e86a5dda.js";import"./getters-c6fb954d.js";import"./util-1396ff7b.js";import"./fetch-34712ac6.js";import"./get-query-arg-cb6b8763.js";const scCompactAddressCss=":host{display:block}.sc-address{display:block;position:relative}.sc-address [hidden]{display:none}.sc-address--loading{min-height:70px}.sc-address--loading sc-skeleton{display:block;margin-bottom:1em}.sc-address__control{display:block}.sc-address__control>*{margin-bottom:-1px}.sc-address__columns{display:flex;flex-direction:row;align-items:center;flex-wrap:wrap;justify-content:space-between}.sc-address__columns>*{flex:1;width:50%;margin-left:-1px}.sc-address__columns>*:first-child{margin-left:0}",ScCompactAddress=class{constructor(e){registerInstance(this,e),this.scChangeAddress=createEvent(this,"scChangeAddress",7),this.scInputAddress=createEvent(this,"scInputAddress",7),this.address={country:null,city:null,line_1:null,line_2:null,postal_code:null,state:null},this.names={country:"shipping_country",city:"shipping_city",line_1:"shipping_line_1",line_2:"shipping_line_2",postal_code:"shipping_postal_code",state:"shipping_state"},this.placeholders={country:"",postal_code:"",state:""},this.label=wp.i18n.__("Country or region","surecart"),this.countryChoices=countryChoices}handleAddressChange(){this.address.country&&(this.setRegions(),this.showState=["US","CA"].includes(this.address.country),this.showPostal=["US"].includes(this.address.country),this.scChangeAddress.emit(this.address),this.scInputAddress.emit(this.address))}updateAddress(e){this.address={...this.address,...e}}handleAddressInput(e){this.scInputAddress.emit({...this.address,...e})}clearAddress(){this.address={country:null,line_1:null,line_2:null,city:null,postal_code:null,state:null}}setRegions(){hasState(this.address.country)?import("./countries-dfee7456.js").then((e=>{this.regions=null==e?void 0:e[this.address.country]})):this.regions=[]}componentWillLoad(){var e;this.handleAddressChange();const s=null===(e=this.countryChoices.find((e=>e.value===this.address.country)))||void 0===e?void 0:e.value;s&&this.updateAddress({country:s})}async reportValidity(){return reportChildrenValidity(this.el)}getStatePlaceholder(){var e,s;return(null===(e=this.placeholders)||void 0===e?void 0:e.state)?this.placeholders.state:"US"===(null===(s=this.address)||void 0===s?void 0:s.country)?wp.i18n.__("State","surecart"):wp.i18n.__("Province/Region","surecart")}render(){var e,s,t,i,r;return h("div",{class:"sc-address",part:"base"},h("sc-form-control",{exportparts:"label, help-text, form-control",label:this.label,class:"sc-address__control",part:"control",required:this.required},h("sc-select",{exportparts:"base:select__base, input, form-control, label, help-text, trigger, panel, caret, search__base, search__input, search__form-control, menu__base, spinner__base, empty",value:null===(e=this.address)||void 0===e?void 0:e.country,onScChange:e=>{this.clearAddress(),this.updateAddress({country:e.target.value||null})},choices:this.countryChoices,autocomplete:"country-name",placeholder:(null===(s=this.placeholders)||void 0===s?void 0:s.country)||wp.i18n.__("Select Your Country","surecart"),name:this.names.country,search:!0,unselect:!1,"squared-bottom":this.showState||this.showPostal,required:this.required}),h("div",{class:"sc-address__columns"},this.showState&&h("sc-select",{exportparts:"base:select__base, input, form-control, label, help-text, trigger, panel, caret, search__base, search__input, search__form-control, menu__base, spinner__base, empty",placeholder:this.getStatePlaceholder(),name:this.names.state,autocomplete:"address-level1",value:null===(t=null==this?void 0:this.address)||void 0===t?void 0:t.state,onScChange:e=>this.updateAddress({state:e.target.value||null}),choices:this.regions,required:this.required,search:!0,"squared-top":!0,unselect:!1,"squared-right":this.showPostal}),this.showPostal&&h("sc-input",{exportparts:"base:input__base, input, form-control, label, help-text",placeholder:(null===(i=this.placeholders)||void 0===i?void 0:i.postal_code)||wp.i18n.__("Postal Code/Zip","surecart"),name:this.names.postal_code,onScChange:e=>this.updateAddress({postal_code:e.target.value||null}),onScInput:e=>this.handleAddressInput({name:e.target.value||null}),autocomplete:"postal-code",required:this.required,value:null===(r=null==this?void 0:this.address)||void 0===r?void 0:r.postal_code,"squared-top":!0,maxlength:5,"squared-left":this.showState}))),this.loading&&h("sc-block-ui",{exportparts:"base:block-ui, content:block-ui__content"}))}get el(){return getElement(this)}static get watchers(){return{address:["handleAddressChange"]}}};ScCompactAddress.style=scCompactAddressCss;const scLineItemTaxCss=":host{display:block}",ScLineItemTax=class{constructor(e){registerInstance(this,e)}renderLabel(){var e,s,t;let i=wp.i18n.sprintf(wp.i18n.__("Estimated %s","surecart"),(null===(e=null==this?void 0:this.order)||void 0===e?void 0:e.tax_label)||"");return"calculated"===(null===(s=null==this?void 0:this.order)||void 0===s?void 0:s.tax_status)&&(i=(null===(t=this.order)||void 0===t?void 0:t.tax_label)||""),h(Fragment,null,`${wp.i18n.__("Tax:","surecart")} ${i}`,this.renderPercent())}renderPercent(){var e;return(null===(e=this.order)||void 0===e?void 0:e.tax_percent)?h(Fragment,null,"(",this.order.tax_percent,"%",")"):""}render(){var e,s,t,i,r,a,o;return(null===(e=null==this?void 0:this.order)||void 0===e?void 0:e.tax_amount)?h("sc-line-item",null,h("span",{slot:"description"},this.renderLabel()),(null===(s=this.order)||void 0===s?void 0:s.tax_exclusive_amount)&&h("span",{slot:"price"},h("sc-format-number",{type:"currency",currency:(null===(t=null==this?void 0:this.order)||void 0===t?void 0:t.currency)||"usd",value:null===(i=null==this?void 0:this.order)||void 0===i?void 0:i.tax_exclusive_amount})),(null===(r=this.order)||void 0===r?void 0:r.tax_inclusive_amount)&&h("span",{slot:"price-description"},"(",h("sc-format-number",{type:"currency",currency:(null===(a=null==this?void 0:this.order)||void 0===a?void 0:a.currency)||"usd",value:null===(o=null==this?void 0:this.order)||void 0===o?void 0:o.tax_inclusive_amount})," ",wp.i18n.__("included","surecart"),")")):null}};openWormhole(ScLineItemTax,["order","loading"],!1),ScLineItemTax.style=scLineItemTaxCss;const scOrderBumpCss=":host{display:block}.bump{display:grid;gap:1em}.bump__text{display:grid;gap:0.25em}.bump__tag{background:var(--sc-color-primary-500);color:var(--sc-color-white);border-radius:var(--sc-input-border-radius-medium);padding:var(--sc-spacing-x-small);font-size:var(--sc-font-size-x-small)}.bump__product{display:flex;align-items:center;gap:var(--sc-choice-padding, 1.3em 1.1em);line-height:var(--sc-line-height-dense)}.bump__product-title{font-weight:var(--sc-font-weight-semibold)}.bump__product-description{color:var(--sc-input-label-color)}.bump__image{width:var(--sc-product-line-item-image-size, 4em);height:var(--sc-product-line-item-image-size, 4em);flex:0 0 var(--sc-product-line-item-image-size, 4em);object-fit:cover;border-radius:4px;border:1px solid var(--sc-color-gray-200);display:block;box-shadow:var(--sc-input-box-shadow)}.bump__price--has-discount .bump__original-price{text-decoration:line-through;color:var(--sc-color-gray-500);font-size:var(--sc-font-size-small)}.bump__price .bump__new-price{font-size:var(--sc-font-size-large);color:var(--sc-color-gray-700)}.bump__price .bump__interval{color:var(--sc-color-gray-500)}.bump__amount{display:flex;align-items:center;gap:var(--sc-spacing-x-small);flex-wrap:wrap;margin-top:var(--sc-spacing-xx-small)}",ScOrderBump=class{constructor(e){registerInstance(this,e),this.scAddLineItem=createEvent(this,"scAddLineItem",7),this.scRemoveLineItem=createEvent(this,"scRemoveLineItem",7)}updateLineItem(e){var s,t,i;const r=(null===(s=this.bump.price)||void 0===s?void 0:s.id)||(null===(t=this.bump)||void 0===t?void 0:t.price);e?this.scAddLineItem.emit({bump:null===(i=this.bump)||void 0===i?void 0:i.id,price_id:r,quantity:1}):this.scRemoveLineItem.emit({price_id:r,quantity:1})}newPrice(){var e,s,t,i,r,a;let o=null,d=(null===(s=null===(e=this.bump)||void 0===e?void 0:e.price)||void 0===s?void 0:s.amount)||0;if((null===(t=this.bump)||void 0===t?void 0:t.amount_off)&&(o=Math.max(0,d-(null===(i=this.bump)||void 0===i?void 0:i.amount_off))),null===(r=this.bump)||void 0===r?void 0:r.percent_off){const e=d*((null===(a=this.bump)||void 0===a?void 0:a.percent_off)/100);o=Math.max(0,d-e)}return o}renderInterval(){var e;const s=intervalString(null===(e=this.bump)||void 0===e?void 0:e.price,{labels:{interval:"/",period:wp.i18n.__("for","surecart")}});return s.trim().length?h("span",{class:"bump__interval"},s):null}renderPrice(){var e,s,t,i,r,a,o;return h("div",{slot:"description",class:{bump__price:!0,"bump__price--has-discount":!!(null===(e=this.bump)||void 0===e?void 0:e.percent_off)||!!(null===(s=this.bump)||void 0===s?void 0:s.amount_off)},part:"price"},h("sc-format-number",{type:"currency",class:"bump__original-price",value:null===(i=null===(t=this.bump)||void 0===t?void 0:t.price)||void 0===i?void 0:i.amount,currency:null===(a=null===(r=this.bump)||void 0===r?void 0:r.price)||void 0===a?void 0:a.currency})," ",0===this.newPrice()&&wp.i18n.__("Free","surecart"),null!==this.newPrice()&&this.newPrice()>0&&h("sc-format-number",{type:"currency",class:"bump__new-price",value:this.newPrice(),currency:(null===(o=this.bump)||void 0===o?void 0:o.price).currency}),this.renderInterval())}renderDiscount(){var e,s,t,i,r;return(null===(e=this.bump)||void 0===e?void 0:e.amount_off)?h("div",{class:"bump__tag"},wp.i18n.__("Save","surecart")," ",h("sc-format-number",{type:"currency",value:-(null===(s=this.bump)||void 0===s?void 0:s.amount_off),currency:(null===(t=this.bump)||void 0===t?void 0:t.price).currency})):(null===(i=this.bump)||void 0===i?void 0:i.percent_off)?h("div",{class:"bump__tag"},wp.i18n.sprintf(wp.i18n.__("Save %s%%","surecart"),null===(r=this.bump)||void 0===r?void 0:r.percent_off)):void 0}render(){var e,s,t,i,r,a,o,d,n,l,c,u,p,m;const _=null===(s=null===(e=this.bump)||void 0===e?void 0:e.price)||void 0===s?void 0:s.product;return h("sc-choice",{value:null===(t=this.bump)||void 0===t?void 0:t.id,type:"checkbox",showControl:this.showControl,checked:isBumpInOrder(this.bump,this.checkout),onScChange:e=>this.updateLineItem(e.target.checked),exportparts:"base, control, checked-icon, title"},h("div",{part:"base-content",class:"bump"},h("div",{class:"bump__text"},h("div",{class:"bump__title"},(null===(r=null===(i=this.bump)||void 0===i?void 0:i.metadata)||void 0===r?void 0:r.cta)||(null===(a=this.bump)||void 0===a?void 0:a.name)||(null==_?void 0:_.name)),h("div",{class:"bump__amount"},this.renderPrice()," ",this.renderDiscount()))),(null===(d=null===(o=this.bump)||void 0===o?void 0:o.metadata)||void 0===d?void 0:d.description)&&h("div",{slot:"footer"},h("sc-divider",{style:{"--spacing":"var(--sc-spacing-medium)"}}),h("div",{class:"bump__product"},!!(null==_?void 0:_.image_url)&&h("img",{src:_.image_url,class:"bump__image"}),h("div",{class:"bump__product-text"},!!(null===(l=null===(n=this.bump)||void 0===n?void 0:n.metadata)||void 0===l?void 0:l.cta)&&h("div",{class:"bump__product-title"},this.bump.name||(null==_?void 0:_.name)),!!(null===(u=null===(c=this.bump)||void 0===c?void 0:c.metadata)||void 0===u?void 0:u.description)&&h("div",{class:"bump__product-description"},null===(m=null===(p=this.bump)||void 0===p?void 0:p.metadata)||void 0===m?void 0:m.description)))))}};ScOrderBump.style=scOrderBumpCss;const scOrderBumpsCss=":host{display:block}.bumps__list{display:grid;gap:10px}",ScOrderBumps=class{constructor(e){registerInstance(this,e)}render(){var e;return(null===(e=null==this?void 0:this.bumps)||void 0===e?void 0:e.length)?h("sc-form-control",{label:this.label||wp.i18n.__("Recommended","surecart"),help:this.help},h("div",{class:"bumps__list"},(this.bumps||[]).map((e=>h("sc-order-bump",{key:null==e?void 0:e.id,showControl:this.showControl,bump:e,checkout:this.checkout}))))):null}};openWormhole(ScOrderBumps,["bumps","checkout"],!1),ScOrderBumps.style=scOrderBumpsCss;const scOrderShippingAddressCss=":host{display:block}.sc-order-shipping__loading{display:flex;flex-direction:column;gap:0.5em}",ScOrderShippingAddress=class{constructor(e){registerInstance(this,e),this.scUpdateOrder=createEvent(this,"scUpdateOrder",7),this.required=!1,this.namePlaceholder=wp.i18n.__("Name or Company Name","surecart"),this.countryPlaceholder=wp.i18n.__("Country","surecart"),this.cityPlaceholder=wp.i18n.__("City","surecart"),this.line1Placeholder=wp.i18n.__("Address","surecart"),this.line2Placeholder=wp.i18n.__("Address Line 2","surecart"),this.postalCodePlaceholder=wp.i18n.__("Postal Code/Zip","surecart"),this.statePlaceholder=wp.i18n.__("State/Province/Region","surecart"),this.placeholders={name:wp.i18n.__("Name or Company Name","surecart"),country:wp.i18n.__("Country","surecart"),city:wp.i18n.__("City","surecart"),line_1:wp.i18n.__("Address","surecart"),line_2:wp.i18n.__("Address Line 2","surecart"),postal_code:wp.i18n.__("Postal Code/Zip","surecart"),state:wp.i18n.__("State/Province/Region","surecart")},this.address={country:null,city:null,line_1:null,line_2:null,postal_code:null,state:null}}handleCustomerAddressChange(e,s){(null==e?void 0:e.id)&&!s&&(this.address={...this.address,...e})}async updateAddressState(e){if(JSON.stringify(e)!==JSON.stringify(this.address)){this.address=e;try{lockCheckout("shipping-address"),state.checkout=await createOrUpdateCheckout({id:state.checkout.id,data:{shipping_address:this.address}})}catch(e){console.error(e)}finally{unLockCheckout("shipping-address")}}}async reportValidity(){return this.input.reportValidity()}componentWillLoad(){this.defaultCountry&&!this.address.country&&(this.address.country=this.defaultCountry),this.handleRequirementChange()}handleRequirementChange(){(this.shippingEnabled||this.taxEnabled)&&(this.required=!0)}render(){return this.shippingEnabled||this.full?h("sc-address",{exportparts:"label, help-text, form-control, input__base, select__base, columns, search__base, menu__base",ref:e=>this.input=e,label:this.label||wp.i18n.__("Shipping Address","surecart"),placeholders:{name:this.namePlaceholder,country:this.countryPlaceholder,city:this.cityPlaceholder,line_1:this.line1Placeholder,line_2:this.line2Placeholder,postal_code:this.postalCodePlaceholder,state:this.statePlaceholder},required:this.required,loading:this.loading,address:this.address,"show-name":this.showName,onScChangeAddress:e=>this.updateAddressState(e.detail)}):h("sc-compact-address",{ref:e=>this.input=e,required:this.required,loading:this.loading,address:this.address,placeholders:{name:this.namePlaceholder,country:this.countryPlaceholder,city:this.cityPlaceholder,line_1:this.line1Placeholder,line_2:this.line2Placeholder,postal_code:this.postalCodePlaceholder,state:this.statePlaceholder},label:this.label,onScChangeAddress:e=>this.updateAddressState(e.detail)})}static get watchers(){return{shippingAddress:["handleCustomerAddressChange"],shippingEnabled:["handleRequirementChange"],taxEnabled:["handleRequirementChange"]}}};openWormhole(ScOrderShippingAddress,["shippingAddress","loading","taxStatus","taxEnabled","shippingEnabled"],!1),ScOrderShippingAddress.style=scOrderShippingAddressCss;const scOrderTaxIdInputCss=":host{display:block}",ScOrderTaxIdInput=class{constructor(e){registerInstance(this,e),this.scUpdateOrder=createEvent(this,"scUpdateOrder",7),this.scError=createEvent(this,"scError",7),this.show=!1,this.busy=!1}getStatus(){var e,s,t;return"eu_vat"!==(null===(e=this.taxIdentifier)||void 0===e?void 0:e.number_type)||"apply_reverse_charge"===(null===(s=this.taxProtocol)||void 0===s?void 0:s.eu_vat_unverified_behavior)?"unknown":(null===(t=this.taxIdentifier)||void 0===t?void 0:t.eu_vat_verified)?"valid":"invalid"}async maybeUpdateOrder(e){try{lockCheckout("tax_identifier"),state.checkout=await createOrUpdateCheckout({id:state.checkout.id,data:{tax_identifier:e}})}catch(e){console.error(e),this.scError.emit(e)}finally{unLockCheckout("tax_identifier")}}render(){var e,s,t,i,r,a;return h("sc-tax-id-input",{show:this.show,number:null===(s=null===(e=this.order)||void 0===e?void 0:e.tax_identifier)||void 0===s?void 0:s.number,type:null===(i=null===(t=this.order)||void 0===t?void 0:t.tax_identifier)||void 0===i?void 0:i.number_type,country:null===(a=null===(r=null==this?void 0:this.order)||void 0===r?void 0:r.shipping_address)||void 0===a?void 0:a.country,status:this.getStatus(),loading:this.busy,onScChange:e=>{e.stopImmediatePropagation(),this.maybeUpdateOrder(e.detail)},otherLabel:this.otherLabel,caGstLabel:this.caGstLabel,auAbnLabel:this.auAbnLabel,gbVatLabel:this.gbVatLabel,euVatLabel:this.euVatLabel})}};openWormhole(ScOrderTaxIdInput,["draft","order","tax_status","taxIdentifier","taxProtocol","busy"],!1),ScOrderTaxIdInput.style=scOrderTaxIdInputCss;export{ScCompactAddress as sc_compact_address,ScLineItemTax as sc_line_item_tax,ScOrderBump as sc_order_bump,ScOrderBumps as sc_order_bumps,ScOrderShippingAddress as sc_order_shipping_address,ScOrderTaxIdInput as sc_order_tax_id_input};