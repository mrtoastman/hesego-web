import{proxyCustomElement,HTMLElement,h}from"@stencil/core/internal/client";import{U as Universe}from"./universe.js";import{c as convertLineItemsToLineItemData}from"./index3.js";import{c as createOrUpdateCheckout}from"./index2.js";import{g as getOrder,s as setOrder}from"./watchers.js";import{u as uiStore}from"./ui.js";import{d as defineCustomElement$4}from"./sc-alert2.js";import{d as defineCustomElement$3}from"./sc-form2.js";import{d as defineCustomElement$2}from"./sc-icon2.js";const query={expand:["line_items","line_item.price","price.product","customer","customer.shipping_address","payment_intent","discount","discount.promotion","discount.coupon","shipping_address","tax_identifier"]},ScCartForm$1=proxyCustomElement(class extends HTMLElement{constructor(){super(),this.__registerHost(),this.quantity=1,this.mode="live"}getLineItem(){var e,t;const r=this.getOrder(),i=((null===(e=null==r?void 0:r.line_items)||void 0===e?void 0:e.data)||[]).find((e=>{var t;return(null===(t=e.price)||void 0===t?void 0:t.id)===this.priceId}));return!!(null==i?void 0:i.id)&&{id:null==i?void 0:i.id,price_id:null===(t=null==i?void 0:i.price)||void 0===t?void 0:t.id,quantity:null==i?void 0:i.quantity}}getOrder(){return getOrder(null==this?void 0:this.formId,this.mode)}async addToCart(){const{price:e}=await this.form.getFormJson();try{this.busy=!0;const t=await this.addOrUpdateLineItem({...e?{ad_hoc_amount:parseInt(e)||null}:{}});setOrder(t,this.formId),uiStore.set("cart",{...uiStore.state.cart,open:!0})}catch(e){console.error(e),this.error=(null==e?void 0:e.message)||wp.i18n.__("Something went wrong","surecart")}finally{this.busy=!1}}async addOrUpdateLineItem(e={}){var t,r;let i=this.getLineItem(),o=convertLineItemsToLineItemData((null===(t=this.getOrder())||void 0===t?void 0:t.line_items)||[]);return await createOrUpdateCheckout({id:null===(r=this.getOrder())||void 0===r?void 0:r.id,data:{live_mode:"live"===this.mode,line_items:[...(o||[]).map((t=>this.priceId===(null==t?void 0:t.price_id)?{...t,...(null==e?void 0:e.ad_hoc_amount)?{ad_hoc_amount:null==e?void 0:e.ad_hoc_amount}:{},quantity:(null==t?void 0:t.ad_hoc_amount)?1:(null==t?void 0:t.quantity)+1}:t)),...i?[]:[{price_id:this.priceId,...(null==e?void 0:e.ad_hoc_amount)?{ad_hoc_amount:null==e?void 0:e.ad_hoc_amount}:{},quantity:1}]]},query:{...query,form_id:this.formId}})}componentWillLoad(){Universe.create(this,this.state())}state(){return{busy:this.busy,error:this.error,order:this.getOrder()}}render(){return h("sc-form",{ref:e=>this.form=e,onScSubmit:()=>{this.addToCart()}},this.error&&h("sc-alert",{open:!!this.error,type:"danger"},h("span",{slot:"title"},wp.i18n.__("Error","surecart")),this.error),h(Universe.Provider,{state:this.state()},h("slot",null)))}static get style(){return"sc-cart-form { display: inline-block }"}},[4,"sc-cart-form",{quantity:[1026],priceId:[1,"price-id"],mode:[1],formId:[513,"form-id"],order:[32],busy:[32],error:[32]}]);function defineCustomElement$1(){"undefined"!=typeof customElements&&["sc-cart-form","sc-alert","sc-form","sc-icon"].forEach((e=>{switch(e){case"sc-cart-form":customElements.get(e)||customElements.define(e,ScCartForm$1);break;case"sc-alert":customElements.get(e)||defineCustomElement$4();break;case"sc-form":customElements.get(e)||defineCustomElement$3();break;case"sc-icon":customElements.get(e)||defineCustomElement$2()}}))}defineCustomElement$1();const ScCartForm=ScCartForm$1,defineCustomElement=defineCustomElement$1;export{ScCartForm,defineCustomElement};