import{r as registerInstance,h,F as Fragment,g as getElement}from"./index-fd4790f6.js";import{a as apiFetch}from"./fetch-34712ac6.js";import{o as onFirstVisible}from"./lazy-64c2bf3b.js";import{a as addQueryArgs}from"./add-query-args-f4c5962b.js";import{g as getQueryArg}from"./get-query-arg-cb6b8763.js";const scSubscriptionCss=":host{display:block}.subscription{display:grid;gap:0.5em}.subscription a{text-decoration:none;font-weight:var(--sc-font-weight-semibold);display:inline-flex;align-items:center;gap:0.25em;color:var(--sc-color-primary-500)}.subscription a.cancel{color:var(--sc-color-danger-500)}",ScSubscription=class{constructor(i){registerInstance(this,i)}componentWillLoad(){onFirstVisible(this.el,(()=>{this.subscription||this.getSubscription()}))}async cancelPendingUpdate(){var i;if(confirm(wp.i18n.__("Are you sure you want to cancel the pending update to your plan?","surecart")))try{this.busy=!0,this.subscription=await apiFetch({path:addQueryArgs(`surecart/v1/subscriptions/${null===(i=this.subscription)||void 0===i?void 0:i.id}/`,{expand:["price","price.product","current_period","period.checkout","purchase","purchase.license","license.activations","discount","discount.coupon"]}),method:"PATCH",data:{purge_pending_update:!0}})}catch(i){(null==i?void 0:i.message)?this.error=i.message:this.error=wp.i18n.__("Something went wrong","surecart"),console.error(this.error)}finally{this.busy=!1}}async renewSubscription(){var i;try{this.error="",this.busy=!0,this.subscription=await apiFetch({path:addQueryArgs(`surecart/v1/subscriptions/${null===(i=this.subscription)||void 0===i?void 0:i.id}/renew`,{expand:["price","price.product","current_period","period.checkout","purchase","purchase.license","license.activations","discount","discount.coupon"]}),method:"PATCH"})}catch(i){this.error=(null==i?void 0:i.message)||wp.i18n.__("Something went wrong","surecart")}finally{this.busy=!1}}async getSubscription(){var i;try{this.loading=!0,this.subscription=await await apiFetch({path:addQueryArgs(`surecart/v1/subscriptions/${this.subscriptionId||(null===(i=this.subscription)||void 0===i?void 0:i.id)}`,{expand:["price","price.product","current_period"],...this.query||{}})})}catch(i){(null==i?void 0:i.message)?this.error=i.message:this.error=wp.i18n.__("Something went wrong","surecart"),console.error(this.error)}finally{this.loading=!1}}renderName(i){var t,e,r;return"string"!=typeof(null===(t=null==i?void 0:i.price)||void 0===t?void 0:t.product)?null===(r=null===(e=null==i?void 0:i.price)||void 0===e?void 0:e.product)||void 0===r?void 0:r.name:wp.i18n.__("Subscription","surecart")}renderRenewalText(i){const t=h("sc-subscription-status-badge",{subscription:i});return(null==i?void 0:i.cancel_at_period_end)&&i.current_period_end_at?h("span",null,t," ",wp.i18n.sprintf(wp.i18n.__("Your plan will be canceled on","surecart"))," ",h("sc-format-date",{date:1e3*i.current_period_end_at,month:"long",day:"numeric",year:"numeric"})):"trialing"===i.status&&i.trial_end_at?h("span",null,t," ",wp.i18n.sprintf(wp.i18n.__("Your plan begins on","surecart"))," ",h("sc-format-date",{date:1e3*i.trial_end_at,month:"long",day:"numeric",year:"numeric"})):"active"===i.status&&i.current_period_end_at?h("span",null,t," ",wp.i18n.sprintf(wp.i18n.__("Your plan renews on","surecart"))," ",h("sc-format-date",{date:1e3*i.current_period_end_at,month:"long",day:"numeric",year:"numeric"})):t}renderEmpty(){return h("slot",{name:"empty"},wp.i18n.__("This subscription does not exist.","surecart"))}renderLoading(){return h("sc-stacked-list-row",{style:{"--columns":"2"},"mobile-size":0},h("div",{style:{padding:"0.5em"}},h("sc-skeleton",{style:{width:"30%",marginBottom:"0.75em"}}),h("sc-skeleton",{style:{width:"20%",marginBottom:"0.75em"}}),h("sc-skeleton",{style:{width:"40%"}})))}renderContent(){return this.loading?this.renderLoading():this.subscription?h(Fragment,null,h("sc-subscription-next-payment",{subscription:this.subscription},h("sc-subscription-details",{subscription:this.subscription}))):this.renderEmpty()}render(){var i,t,e,r;return h("sc-dashboard-module",{heading:this.heading||wp.i18n.__("Current Plan","surecart"),class:"subscription",error:this.error},!!this.subscription&&h("sc-flex",{slot:"end"},"update_payment_method"!==getQueryArg(window.location.href,"action")&&h("sc-button",{type:"link",href:addQueryArgs(window.location.href,{action:"update_payment_method"})},h("sc-icon",{name:"credit-card",slot:"prefix"}),wp.i18n.__("Update Payment Method","surecart")),!!Object.keys(null===(i=this.subscription)||void 0===i?void 0:i.pending_update).length&&h("sc-button",{type:"link",onClick:()=>this.cancelPendingUpdate()},h("sc-icon",{name:"x-octagon",slot:"prefix"}),wp.i18n.__("Cancel Scheduled Update","surecart")),(null===(t=null==this?void 0:this.subscription)||void 0===t?void 0:t.cancel_at_period_end)?h("sc-button",{type:"link",onClick:()=>this.renewSubscription()},h("sc-icon",{name:"repeat",slot:"prefix"}),wp.i18n.__("Restore Plan","surecart")):"canceled"!==(null===(e=this.subscription)||void 0===e?void 0:e.status)&&(null===(r=this.subscription)||void 0===r?void 0:r.current_period_end_at)&&this.showCancel&&h("sc-button",{type:"link",onClick:()=>this.cancelModal=!0},h("sc-icon",{name:"x",slot:"prefix"}),wp.i18n.__("Cancel Plan","surecart"))),h("sc-card",{style:{"--overflow":"hidden"},noPadding:!0},this.renderContent()),this.busy&&h("sc-block-ui",{spinner:!0}),h("sc-cancel-dialog",{subscription:this.subscription,protocol:this.protocol,open:this.cancelModal,onScRequestClose:()=>this.cancelModal=!1,onScRefresh:()=>this.getSubscription()}))}get el(){return getElement(this)}};ScSubscription.style=scSubscriptionCss;export{ScSubscription as sc_subscription};