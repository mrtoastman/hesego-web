"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const index=require("./index-9c866aeb.js"),functions=require("./functions-77ef3f22.js"),fetch=require("./fetch-b673a242.js"),index$1=require("./index-cf22257b.js"),index$2=require("./index-2840f0ff.js");require("./add-query-args-17c551b6.js"),require("./watchers-203d7acd.js"),require("./index-f6f80680.js"),require("./watchers-be62d6ad.js"),require("./watchers-d5742848.js"),require("./getters-c6087113.js"),require("./util-98cb3494.js"),require("./get-query-arg-53bf21e2.js");const paypalButtonsCss=':host{display:block}.paypal-buttons{position:relative;line-height:0;text-align:center}.paypal-buttons:not(.paypal-buttons--busy):after{content:" ";border-bottom:1px solid var(--sc-input-border-color);width:100%;height:0;top:50%;left:0;right:0;position:absolute}',ScPaypalButtons=class{constructor(e){index.registerInstance(this,e),this.scError=index.createEvent(this,"scError",7),this.scSetState=index.createEvent(this,"scSetState",7),this.scPaid=index.createEvent(this,"scPaid",7),this.busy=!1,this.buttons=["paypal","card"],this.label="paypal",this.color="gold"}handleOrderChange(e,t){(null==e?void 0:e.updated_at)!==(null==t?void 0:t.updated_at)&&(this.cardContainer.innerHTML="",this.paypalContainer.innerHTML="",this.loadScript())}async loadScript(){var e,t;if(this.clientId&&this.merchantId)try{const s=await functions.loadScript(functions.getScriptLoadParams({clientId:this.clientId,merchantId:this.merchantId,merchantInitiated:this.merchantInitiated,reusable:null===(e=this.order)||void 0===e?void 0:e.reusable_payment_method_required,currency:null===(t=this.order)||void 0===t?void 0:t.currency}));this.renderButtons(s)}catch(e){console.error("failed to load the PayPal JS SDK script",e)}}componentDidLoad(){this.loadScript()}renderButtons(e){const t={onClick:async(e,t)=>{const s=this.el.closest("sc-checkout");return await s.validate()?t.resolve():t.reject()},onInit:()=>{this.loaded=!0},onCancel:()=>{this.scSetState.emit("REJECT")},onApprove:async()=>{var e,t,s,i;try{this.order=await index$2.fetchCheckout({id:null===(e=this.order)||void 0===e?void 0:e.id})}catch(e){console.error(e),this.scError.emit({code:"could_not_capture",message:wp.i18n.__("The payment did not process. Please try again.","surecart")}),this.scSetState.emit("REJECT")}try{this.scSetState.emit("PAYING");const e=await fetch.apiFetch({method:"PATCH",path:`surecart/v1/payment_intents/${(null===(s=null===(t=this.order)||void 0===t?void 0:t.payment_intent)||void 0===s?void 0:s.id)||(null===(i=this.order)||void 0===i?void 0:i.payment_intent)}/capture`});["succeeded","pending","requires_approval"].includes(null==e?void 0:e.status)?(this.scSetState.emit("PAID"),this.scPaid.emit()):(this.scError.emit({code:"could_not_capture",message:wp.i18n.__("The payment did not process. Please try again.","surecart")}),this.scSetState.emit("REJECT"))}catch(e){console.error(e),this.scError.emit({code:"could_not_capture",message:wp.i18n.__("The payment did not process. Please try again.","surecart")}),this.scSetState.emit("REJECT")}},onError:e=>{console.error(e),this.scError.emit({code:null==e?void 0:e.code,message:null==e?void 0:e.message}),this.scSetState.emit("REJECT")}};if(t[index$1.hasSubscription(this.order)?"createBillingAgreement":"createOrder"]=async()=>new Promise((async(e,t)=>{var s,i;const r=this.el.closest("sc-checkout"),n=await r.submit();return n instanceof Error?t(n):"finalized"!==(null==n?void 0:n.status)?t(new Error("Something went wrong. Please try again.")):(null===(s=null==n?void 0:n.payment_intent)||void 0===s?void 0:s.external_intent_id)?e(null===(i=null==n?void 0:n.payment_intent)||void 0===i?void 0:i.external_intent_id):(this.scError.emit({code:"missing_payment_intent",message:wp.i18n.__("Something went wrong. Please contact us for payment.","surecart")}),t())})),e.FUNDING.PAYPAL){const s=e.Buttons({fundingSource:e.FUNDING.PAYPAL,style:{label:this.label,color:this.color},...t});s.isEligible()&&s.render(this.paypalContainer)}if(e.FUNDING.CARD){const s=e.Buttons({fundingSource:e.FUNDING.CARD,style:{color:"black"},...t});s.isEligible()&&s.render(this.cardContainer)}}render(){return index.h("div",{part:`base ${this.busy||!this.loaded&&"base--busy"}`,class:{"paypal-buttons":!0,"paypal-buttons--busy":this.busy||!this.loaded}},(!this.loaded||this.busy)&&index.h("sc-skeleton",{style:{height:"55px","--border-radius":"4px",cursor:"wait"}}),index.h("div",{class:"sc-paypal-button-container",hidden:!this.loaded||this.busy},index.h("div",{part:"paypal-card-button",hidden:!this.buttons.includes("card"),class:"sc-paypal-card-button",ref:e=>this.cardContainer=e}),index.h("div",{part:"paypal-button",hidden:!this.buttons.includes("paypal"),class:"sc-paypal-button",ref:e=>this.paypalContainer=e})))}get el(){return index.getElement(this)}static get watchers(){return{order:["handleOrderChange"]}}};ScPaypalButtons.style=paypalButtonsCss;const scSecureNoticeCss=":host{display:block;--sc-secure-notice-icon-color:var(--sc-color-gray-300);--sc-secure-notice-font-size:var(--sc-font-size-small);--sc-secure-notice-color:var(--sc-color-gray-500)}.notice{color:var(--sc-secure-notice-color);font-size:var(--sc-secure-notice-font-size);display:flex;align-items:center;gap:5px}.notice__text{flex:1;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap}.notice__icon{color:var(--sc-secure-notice-icon-color);margin-right:5px}",ScSecureNotice=class{constructor(e){index.registerInstance(this,e)}render(){return index.h("div",{class:"notice",part:"base"},index.h("svg",{class:"notice__icon",part:"icon",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 512 512",fill:"currentColor"},index.h("path",{d:"M368,192H352V112a96,96,0,1,0-192,0v80H144a64.07,64.07,0,0,0-64,64V432a64.07,64.07,0,0,0,64,64H368a64.07,64.07,0,0,0,64-64V256A64.07,64.07,0,0,0,368,192Zm-48,0H192V112a64,64,0,1,1,128,0Z"})),index.h("span",{class:"notice__text",part:"text"},index.h("slot",{name:"prefix"}),index.h("slot",null),index.h("slot",{name:"suffix"})))}};ScSecureNotice.style=scSecureNoticeCss,exports.sc_paypal_buttons=ScPaypalButtons,exports.sc_secure_notice=ScSecureNotice;