import{Component,Event,h,Prop}from"@stencil/core";import{openWormhole}from"stencil-wormhole";import{hasSubscription}from"../../../../functions/line-items";import{intervalString}from"../../../../functions/price";export class ScLineItems{constructor(){this.editLineItems=!0,this.removeLineItems=!0,this.lockedChoices=[]}updateQuantity(e,i){this.scUpdateLineItem.emit({price_id:e.price.id,quantity:i})}removeLineItem(e){this.scRemoveLineItem.emit({price_id:e.price.id,quantity:1})}getName(e){var i,t,o,l,n;let r="";return r=Object.keys(this.prices||{}).filter((i=>this.prices[i].product===e.price.product.id)).length>1?`${null===(t=null===(i=null==e?void 0:e.price)||void 0===i?void 0:i.product)||void 0===t?void 0:t.name} â€“ ${null===(o=null==e?void 0:e.price)||void 0===o?void 0:o.name}`:null===(n=null===(l=null==e?void 0:e.price)||void 0===l?void 0:l.product)||void 0===n?void 0:n.name,r}isLocked(e){return this.lockedChoices.some((i=>i.id===e.price.id))}isEditable(e){var i;return!(null===(i=null==e?void 0:e.price)||void 0===i?void 0:i.ad_hoc)&&!(null==e?void 0:e.bump_amount)&&(null!==this.editable?this.editable:this.editLineItems)}isRemovable(){return null!==this.removable?this.removable:this.removeLineItems}render(){var e,i,t,o,l;return this.busy&&!(null===(t=null===(i=null===(e=this.order)||void 0===e?void 0:e.line_items)||void 0===i?void 0:i.data)||void 0===t?void 0:t.length)?h("sc-line-item",null,h("sc-skeleton",{style:{width:"50px",height:"50px","--border-radius":"0"},slot:"image"}),h("sc-skeleton",{slot:"title",style:{width:"120px",display:"inline-block"}}),h("sc-skeleton",{slot:"description",style:{width:"60px",display:"inline-block"}}),h("sc-skeleton",{style:{width:"120px",display:"inline-block"},slot:"price"}),h("sc-skeleton",{style:{width:"60px",display:"inline-block"},slot:"price-description"})):h("div",{class:"line-items"},((null===(l=null===(o=this.order)||void 0===o?void 0:o.line_items)||void 0===l?void 0:l.data)||[]).sort(((e,i)=>{var t,o,l,n;return(null===(t=e.price)||void 0===t?void 0:t.id)<(null===(o=i.price)||void 0===o?void 0:o.id)?-1:(null===(l=e.price)||void 0===l?void 0:l.id)>(null===(n=i.price)||void 0===n?void 0:n.id)?1:0})).map((e=>{var i,t,o,l,n,r,s,a,d,c;return h("div",{class:"line-item"},h("sc-product-line-item",{key:e.id,imageUrl:null===(t=null===(i=null==e?void 0:e.price)||void 0===i?void 0:i.product)||void 0===t?void 0:t.image_url,name:null===(l=null===(o=null==e?void 0:e.price)||void 0===o?void 0:o.product)||void 0===l?void 0:l.name,max:null===(r=null===(n=null==e?void 0:e.price)||void 0===n?void 0:n.product)||void 0===r?void 0:r.purchase_limit,editable:this.isEditable(e),removable:this.isRemovable(),quantity:e.quantity,fees:null===(s=null==e?void 0:e.fees)||void 0===s?void 0:s.data,setupFeeTrialEnabled:null===(a=null==e?void 0:e.price)||void 0===a?void 0:a.setup_fee_trial_enabled,amount:null!==e.ad_hoc_amount?e.ad_hoc_amount:e.subtotal_amount,scratchAmount:null==e.ad_hoc_amount&&(null==e?void 0:e.scratch_amount),currency:null===(d=this.order)||void 0===d?void 0:d.currency,trialDurationDays:null===(c=null==e?void 0:e.price)||void 0===c?void 0:c.trial_duration_days,interval:!!(null==e?void 0:e.price)&&intervalString(null==e?void 0:e.price,{showOnce:hasSubscription(this.order)}),onScUpdateQuantity:i=>this.updateQuantity(e,i.detail),onScRemove:()=>this.removeLineItem(e)}))})))}static get is(){return"sc-line-items"}static get encapsulation(){return"shadow"}static get originalStyleUrls(){return{$:["sc-line-items.css"]}}static get styleUrls(){return{$:["sc-line-items.css"]}}static get properties(){return{order:{type:"unknown",mutable:!1,complexType:{original:"Checkout",resolved:"Checkout",references:{Checkout:{location:"import",path:"../../../../types"}}},required:!1,optional:!1,docs:{tags:[],text:""}},busy:{type:"boolean",mutable:!1,complexType:{original:"boolean",resolved:"boolean",references:{}},required:!1,optional:!1,docs:{tags:[],text:""},attribute:"busy",reflect:!1},prices:{type:"unknown",mutable:!1,complexType:{original:"Prices",resolved:"{ [id: string]: Price; }",references:{Prices:{location:"import",path:"../../../../types"}}},required:!1,optional:!1,docs:{tags:[],text:""}},editable:{type:"boolean",mutable:!1,complexType:{original:"boolean",resolved:"boolean",references:{}},required:!1,optional:!1,docs:{tags:[],text:""},attribute:"editable",reflect:!1},removable:{type:"boolean",mutable:!1,complexType:{original:"boolean",resolved:"boolean",references:{}},required:!1,optional:!1,docs:{tags:[],text:""},attribute:"removable",reflect:!1},editLineItems:{type:"boolean",mutable:!1,complexType:{original:"boolean",resolved:"boolean",references:{}},required:!1,optional:!1,docs:{tags:[],text:""},attribute:"edit-line-items",reflect:!1,defaultValue:"true"},removeLineItems:{type:"boolean",mutable:!1,complexType:{original:"boolean",resolved:"boolean",references:{}},required:!1,optional:!1,docs:{tags:[],text:""},attribute:"remove-line-items",reflect:!1,defaultValue:"true"},lockedChoices:{type:"unknown",mutable:!1,complexType:{original:"Array<PriceChoice>",resolved:"PriceChoice[]",references:{Array:{location:"global"},PriceChoice:{location:"import",path:"../../../../types"}}},required:!1,optional:!1,docs:{tags:[],text:""},defaultValue:"[]"}}}static get events(){return[{method:"scUpdateLineItem",name:"scUpdateLineItem",bubbles:!0,cancelable:!0,composed:!0,docs:{tags:[],text:"Update the line item."},complexType:{original:"LineItemData",resolved:"LineItemData",references:{LineItemData:{location:"import",path:"../../../../types"}}}},{method:"scRemoveLineItem",name:"scRemoveLineItem",bubbles:!0,cancelable:!0,composed:!0,docs:{tags:[],text:"Remove the line item."},complexType:{original:"LineItemData",resolved:"LineItemData",references:{LineItemData:{location:"import",path:"../../../../types"}}}}]}}openWormhole(ScLineItems,["order","busy","prices","lockedChoices","editLineItems","removeLineItems"],!1);