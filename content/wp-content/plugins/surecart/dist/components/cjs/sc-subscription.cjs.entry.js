"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const index=require("./index-9c866aeb.js"),fetch=require("./fetch-b673a242.js"),lazy=require("./lazy-bc8baeab.js"),addQueryArgs=require("./add-query-args-17c551b6.js"),getQueryArg=require("./get-query-arg-53bf21e2.js"),scSubscriptionCss=":host{display:block}.subscription{display:grid;gap:0.5em}.subscription a{text-decoration:none;font-weight:var(--sc-font-weight-semibold);display:inline-flex;align-items:center;gap:0.25em;color:var(--sc-color-primary-500)}.subscription a.cancel{color:var(--sc-color-danger-500)}",ScSubscription=class{constructor(e){index.registerInstance(this,e)}componentWillLoad(){lazy.onFirstVisible(this.el,(()=>{this.subscription||this.getSubscription()}))}async cancelPendingUpdate(){var e;if(confirm(wp.i18n.__("Are you sure you want to cancel the pending update to your plan?","surecart")))try{this.busy=!0,this.subscription=await fetch.apiFetch({path:addQueryArgs.addQueryArgs(`surecart/v1/subscriptions/${null===(e=this.subscription)||void 0===e?void 0:e.id}/`,{expand:["price","price.product","current_period","period.checkout","purchase","purchase.license","license.activations","discount","discount.coupon"]}),method:"PATCH",data:{purge_pending_update:!0}})}catch(e){(null==e?void 0:e.message)?this.error=e.message:this.error=wp.i18n.__("Something went wrong","surecart"),console.error(this.error)}finally{this.busy=!1}}async renewSubscription(){var e;try{this.error="",this.busy=!0,this.subscription=await fetch.apiFetch({path:addQueryArgs.addQueryArgs(`surecart/v1/subscriptions/${null===(e=this.subscription)||void 0===e?void 0:e.id}/renew`,{expand:["price","price.product","current_period","period.checkout","purchase","purchase.license","license.activations","discount","discount.coupon"]}),method:"PATCH"})}catch(e){this.error=(null==e?void 0:e.message)||wp.i18n.__("Something went wrong","surecart")}finally{this.busy=!1}}async getSubscription(){var e;try{this.loading=!0,this.subscription=await await fetch.apiFetch({path:addQueryArgs.addQueryArgs(`surecart/v1/subscriptions/${this.subscriptionId||(null===(e=this.subscription)||void 0===e?void 0:e.id)}`,{expand:["price","price.product","current_period"],...this.query||{}})})}catch(e){(null==e?void 0:e.message)?this.error=e.message:this.error=wp.i18n.__("Something went wrong","surecart"),console.error(this.error)}finally{this.loading=!1}}renderName(e){var i,t,n;return"string"!=typeof(null===(i=null==e?void 0:e.price)||void 0===i?void 0:i.product)?null===(n=null===(t=null==e?void 0:e.price)||void 0===t?void 0:t.product)||void 0===n?void 0:n.name:wp.i18n.__("Subscription","surecart")}renderRenewalText(e){const i=index.h("sc-subscription-status-badge",{subscription:e});return(null==e?void 0:e.cancel_at_period_end)&&e.current_period_end_at?index.h("span",null,i," ",wp.i18n.sprintf(wp.i18n.__("Your plan will be canceled on","surecart"))," ",index.h("sc-format-date",{date:1e3*e.current_period_end_at,month:"long",day:"numeric",year:"numeric"})):"trialing"===e.status&&e.trial_end_at?index.h("span",null,i," ",wp.i18n.sprintf(wp.i18n.__("Your plan begins on","surecart"))," ",index.h("sc-format-date",{date:1e3*e.trial_end_at,month:"long",day:"numeric",year:"numeric"})):"active"===e.status&&e.current_period_end_at?index.h("span",null,i," ",wp.i18n.sprintf(wp.i18n.__("Your plan renews on","surecart"))," ",index.h("sc-format-date",{date:1e3*e.current_period_end_at,month:"long",day:"numeric",year:"numeric"})):i}renderEmpty(){return index.h("slot",{name:"empty"},wp.i18n.__("This subscription does not exist.","surecart"))}renderLoading(){return index.h("sc-stacked-list-row",{style:{"--columns":"2"},"mobile-size":0},index.h("div",{style:{padding:"0.5em"}},index.h("sc-skeleton",{style:{width:"30%",marginBottom:"0.75em"}}),index.h("sc-skeleton",{style:{width:"20%",marginBottom:"0.75em"}}),index.h("sc-skeleton",{style:{width:"40%"}})))}renderContent(){return this.loading?this.renderLoading():this.subscription?index.h(index.Fragment,null,index.h("sc-subscription-next-payment",{subscription:this.subscription},index.h("sc-subscription-details",{subscription:this.subscription}))):this.renderEmpty()}render(){var e,i,t,n;return index.h("sc-dashboard-module",{heading:this.heading||wp.i18n.__("Current Plan","surecart"),class:"subscription",error:this.error},!!this.subscription&&index.h("sc-flex",{slot:"end"},"update_payment_method"!==getQueryArg.getQueryArg(window.location.href,"action")&&index.h("sc-button",{type:"link",href:addQueryArgs.addQueryArgs(window.location.href,{action:"update_payment_method"})},index.h("sc-icon",{name:"credit-card",slot:"prefix"}),wp.i18n.__("Update Payment Method","surecart")),!!Object.keys(null===(e=this.subscription)||void 0===e?void 0:e.pending_update).length&&index.h("sc-button",{type:"link",onClick:()=>this.cancelPendingUpdate()},index.h("sc-icon",{name:"x-octagon",slot:"prefix"}),wp.i18n.__("Cancel Scheduled Update","surecart")),(null===(i=null==this?void 0:this.subscription)||void 0===i?void 0:i.cancel_at_period_end)?index.h("sc-button",{type:"link",onClick:()=>this.renewSubscription()},index.h("sc-icon",{name:"repeat",slot:"prefix"}),wp.i18n.__("Restore Plan","surecart")):"canceled"!==(null===(t=this.subscription)||void 0===t?void 0:t.status)&&(null===(n=this.subscription)||void 0===n?void 0:n.current_period_end_at)&&this.showCancel&&index.h("sc-button",{type:"link",onClick:()=>this.cancelModal=!0},index.h("sc-icon",{name:"x",slot:"prefix"}),wp.i18n.__("Cancel Plan","surecart"))),index.h("sc-card",{style:{"--overflow":"hidden"},noPadding:!0},this.renderContent()),this.busy&&index.h("sc-block-ui",{spinner:!0}),index.h("sc-cancel-dialog",{subscription:this.subscription,protocol:this.protocol,open:this.cancelModal,onScRequestClose:()=>this.cancelModal=!1,onScRefresh:()=>this.getSubscription()}))}get el(){return index.getElement(this)}};ScSubscription.style=scSubscriptionCss,exports.sc_subscription=ScSubscription;