"use strict";const index=require("./index-f6f80680.js"),addQueryArgs=require("./add-query-args-17c551b6.js");function removeQueryArgs(e){const t=e.indexOf("?");if(-1===t)return e;const r=addQueryArgs.getQueryArgs(e),o=e.substr(0,t);for(var s=arguments.length,n=new Array(s>1?s-1:0),d=1;d<s;d++)n[d-1]=arguments[d];n.forEach((e=>delete r[e]));const a=addQueryArgs.buildQueryString(r);return a?o+"?"+a:o}const{state:state,onChange:onChange,on:on,set:set,get:get,dispose:dispose}=index.createStore({formId:null,groupId:null,mode:"live",locks:[],product:null,checkout:null,currencyCode:"usd",abandonedCheckoutReturnUrl:null,abandonedCheckoutEnabled:!0},((e,t)=>JSON.stringify(e)!==JSON.stringify(t))),safeRead=(e,t)=>{try{return JSON.parse(e.getItem(t))}catch{return null}},debounce=e=>{let t=!1;return()=>{t||(t=!0,setTimeout((()=>{e(),t=!1}),0))}},createStorageStore=(e,t,r,o=!1)=>{var s;const n=index.createStore(null!==(s=safeRead(e,t))&&void 0!==s?s:r,((e,t)=>JSON.stringify(e)!==JSON.stringify(t))),d=debounce((()=>e.setItem(t,JSON.stringify(n.state))));return d(),o&&window.addEventListener("storage",(()=>{const r=safeRead(e,t);if(null!==r)for(const e in r)n.set(e,r[e])})),n.use({set:d,reset:d}),n},createLocalStore=(e,t,r=!1)=>createStorageStore(localStorage,e,t,r);var _a;const store=(null===(_a=null===window||void 0===window?void 0:window.scData)||void 0===_a?void 0:_a.do_not_persist_cart)?index.createStore({live:{},test:{}}):createLocalStore("surecart-local-storage",{live:{},test:{}},!0);window.scStore=store;const getOrder=(e,t)=>{var r;return(null===(r=store.state[t])||void 0===r?void 0:r[e])||{}},getCheckout=getOrder,setOrder=(e,t)=>{var r;const o=(null==e?void 0:e.live_mode)?"live":"test";store.set(o,{...store.state[o],[t]:e}),state.formId===t&&state.mode===o&&(state.checkout=e),(null===(r=null===window||void 0===window?void 0:window.scData)||void 0===r?void 0:r.do_not_persist_cart)&&(null==e?void 0:e.id)&&window.history.replaceState({},document.title,addQueryArgs.addQueryArgs(window.location.href,{checkout_id:null==e?void 0:e.id}))},setCheckout=setOrder,clearOrder=(e,t)=>{const{[e]:r,...o}=store.state[t];return window.history.replaceState({},document.title,removeQueryArgs(window.location.href,"redirect_status","coupon","line_items","confirm_checkout_id","checkout_id")),store.set(t,o)},clearCheckout=clearOrder;onChange("checkout",(e=>setCheckout(e,state.formId))),on("get",(e=>{if("checkout"===e){const e=getCheckout(state.formId,state.mode);(null==e?void 0:e.id)&&(state.checkout=e)}})),exports.clearCheckout=clearCheckout,exports.clearOrder=clearOrder,exports.getCheckout=getCheckout,exports.getOrder=getOrder,exports.on=on,exports.onChange=onChange,exports.removeQueryArgs=removeQueryArgs,exports.setOrder=setOrder,exports.state=state;