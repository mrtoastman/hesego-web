import{c as createStore}from"./index-26bbcef3.js";import{g as getQueryArgs,b as buildQueryString,a as addQueryArgs}from"./add-query-args-f4c5962b.js";function removeQueryArgs(e){const t=e.indexOf("?");if(-1===t)return e;const r=getQueryArgs(e),o=e.substr(0,t);for(var s=arguments.length,a=new Array(s>1?s-1:0),n=1;n<s;n++)a[n-1]=arguments[n];a.forEach((e=>delete r[e]));const d=buildQueryString(r);return d?o+"?"+d:o}const{state:state,onChange:onChange,on:on,set:set,get:get,dispose:dispose}=createStore({formId:null,groupId:null,mode:"live",locks:[],product:null,checkout:null,currencyCode:"usd",abandonedCheckoutReturnUrl:null,abandonedCheckoutEnabled:!0},((e,t)=>JSON.stringify(e)!==JSON.stringify(t))),safeRead=(e,t)=>{try{return JSON.parse(e.getItem(t))}catch{return null}},debounce=e=>{let t=!1;return()=>{t||(t=!0,setTimeout((()=>{e(),t=!1}),0))}},createStorageStore=(e,t,r,o=!1)=>{var s;const a=createStore(null!==(s=safeRead(e,t))&&void 0!==s?s:r,((e,t)=>JSON.stringify(e)!==JSON.stringify(t))),n=debounce((()=>e.setItem(t,JSON.stringify(a.state))));return n(),o&&window.addEventListener("storage",(()=>{const r=safeRead(e,t);if(null!==r)for(const e in r)a.set(e,r[e])})),a.use({set:n,reset:n}),a},createLocalStore=(e,t,r=!1)=>createStorageStore(localStorage,e,t,r);var _a;const store=(null===(_a=null===window||void 0===window?void 0:window.scData)||void 0===_a?void 0:_a.do_not_persist_cart)?createStore({live:{},test:{}}):createLocalStore("surecart-local-storage",{live:{},test:{}},!0);window.scStore=store;const getOrder=(e,t)=>{var r;return(null===(r=store.state[t])||void 0===r?void 0:r[e])||{}},getCheckout=getOrder,setOrder=(e,t)=>{var r;const o=(null==e?void 0:e.live_mode)?"live":"test";store.set(o,{...store.state[o],[t]:e}),state.formId===t&&state.mode===o&&(state.checkout=e),(null===(r=null===window||void 0===window?void 0:window.scData)||void 0===r?void 0:r.do_not_persist_cart)&&(null==e?void 0:e.id)&&window.history.replaceState({},document.title,addQueryArgs(window.location.href,{checkout_id:null==e?void 0:e.id}))},setCheckout=setOrder,clearOrder=(e,t)=>{const{[e]:r,...o}=store.state[t];return window.history.replaceState({},document.title,removeQueryArgs(window.location.href,"redirect_status","coupon","line_items","confirm_checkout_id","checkout_id")),store.set(t,o)},clearCheckout=clearOrder;onChange("checkout",(e=>setCheckout(e,state.formId))),on("get",(e=>{if("checkout"===e){const e=getCheckout(state.formId,state.mode);(null==e?void 0:e.id)&&(state.checkout=e)}}));export{state as a,getCheckout as b,clearOrder as c,on as d,clearCheckout as e,getOrder as g,onChange as o,removeQueryArgs as r,setOrder as s};