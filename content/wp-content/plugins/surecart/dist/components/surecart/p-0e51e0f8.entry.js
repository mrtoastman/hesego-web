import{r as t,h as i,F as e,g as s}from"./p-dfbe004d.js";import{a as n}from"./p-d8453138.js";import{o}from"./p-c2833cb1.js";import{a as r}from"./p-1c2e2695.js";import{g as c}from"./p-4d73f82a.js";const a=class{constructor(i){t(this,i)}componentWillLoad(){o(this.el,(()=>{this.subscription||this.getSubscription()}))}async cancelPendingUpdate(){var i;if(confirm(wp.i18n.__("Are you sure you want to cancel the pending update to your plan?","surecart")))try{this.busy=!0,this.subscription=await n({path:r(`surecart/v1/subscriptions/${null===(i=this.subscription)||void 0===i?void 0:i.id}/`,{expand:["price","price.product","current_period","period.checkout","purchase","purchase.license","license.activations","discount","discount.coupon"]}),method:"PATCH",data:{purge_pending_update:!0}})}catch(i){this.error=(null==i?void 0:i.message)?i.message:wp.i18n.__("Something went wrong","surecart"),console.error(this.error)}finally{this.busy=!1}}async renewSubscription(){var i;try{this.error="",this.busy=!0,this.subscription=await n({path:r(`surecart/v1/subscriptions/${null===(i=this.subscription)||void 0===i?void 0:i.id}/renew`,{expand:["price","price.product","current_period","period.checkout","purchase","purchase.license","license.activations","discount","discount.coupon"]}),method:"PATCH"})}catch(i){this.error=(null==i?void 0:i.message)||wp.i18n.__("Something went wrong","surecart")}finally{this.busy=!1}}async getSubscription(){var i;try{this.loading=!0,this.subscription=await await n({path:r(`surecart/v1/subscriptions/${this.subscriptionId||(null===(i=this.subscription)||void 0===i?void 0:i.id)}`,{expand:["price","price.product","current_period"],...this.query||{}})})}catch(i){this.error=(null==i?void 0:i.message)?i.message:wp.i18n.__("Something went wrong","surecart"),console.error(this.error)}finally{this.loading=!1}}renderName(i){var t,e,n;return"string"!=typeof(null===(t=null==i?void 0:i.price)||void 0===t?void 0:t.product)?null===(n=null===(e=null==i?void 0:i.price)||void 0===e?void 0:e.product)||void 0===n?void 0:n.name:wp.i18n.__("Subscription","surecart")}renderRenewalText(t){const e=i("sc-subscription-status-badge",{subscription:t});return(null==t?void 0:t.cancel_at_period_end)&&t.current_period_end_at?i("span",null,e," ",wp.i18n.sprintf(wp.i18n.__("Your plan will be canceled on","surecart"))," ",i("sc-format-date",{date:1e3*t.current_period_end_at,month:"long",day:"numeric",year:"numeric"})):"trialing"===t.status&&t.trial_end_at?i("span",null,e," ",wp.i18n.sprintf(wp.i18n.__("Your plan begins on","surecart"))," ",i("sc-format-date",{date:1e3*t.trial_end_at,month:"long",day:"numeric",year:"numeric"})):"active"===t.status&&t.current_period_end_at?i("span",null,e," ",wp.i18n.sprintf(wp.i18n.__("Your plan renews on","surecart"))," ",i("sc-format-date",{date:1e3*t.current_period_end_at,month:"long",day:"numeric",year:"numeric"})):e}renderEmpty(){return i("slot",{name:"empty"},wp.i18n.__("This subscription does not exist.","surecart"))}renderLoading(){return i("sc-stacked-list-row",{style:{"--columns":"2"},"mobile-size":0},i("div",{style:{padding:"0.5em"}},i("sc-skeleton",{style:{width:"30%",marginBottom:"0.75em"}}),i("sc-skeleton",{style:{width:"20%",marginBottom:"0.75em"}}),i("sc-skeleton",{style:{width:"40%"}})))}renderContent(){return this.loading?this.renderLoading():this.subscription?i(e,null,i("sc-subscription-next-payment",{subscription:this.subscription},i("sc-subscription-details",{subscription:this.subscription}))):this.renderEmpty()}render(){var t,e,n,s;return i("sc-dashboard-module",{heading:this.heading||wp.i18n.__("Current Plan","surecart"),class:"subscription",error:this.error},!!this.subscription&&i("sc-flex",{slot:"end"},"update_payment_method"!==c(window.location.href,"action")&&i("sc-button",{type:"link",href:r(window.location.href,{action:"update_payment_method"})},i("sc-icon",{name:"credit-card",slot:"prefix"}),wp.i18n.__("Update Payment Method","surecart")),!!Object.keys(null===(t=this.subscription)||void 0===t?void 0:t.pending_update).length&&i("sc-button",{type:"link",onClick:()=>this.cancelPendingUpdate()},i("sc-icon",{name:"x-octagon",slot:"prefix"}),wp.i18n.__("Cancel Scheduled Update","surecart")),(null===(e=null==this?void 0:this.subscription)||void 0===e?void 0:e.cancel_at_period_end)?i("sc-button",{type:"link",onClick:()=>this.renewSubscription()},i("sc-icon",{name:"repeat",slot:"prefix"}),wp.i18n.__("Restore Plan","surecart")):"canceled"!==(null===(n=this.subscription)||void 0===n?void 0:n.status)&&(null===(s=this.subscription)||void 0===s?void 0:s.current_period_end_at)&&this.showCancel&&i("sc-button",{type:"link",onClick:()=>this.cancelModal=!0},i("sc-icon",{name:"x",slot:"prefix"}),wp.i18n.__("Cancel Plan","surecart"))),i("sc-card",{style:{"--overflow":"hidden"},noPadding:!0},this.renderContent()),this.busy&&i("sc-block-ui",{spinner:!0}),i("sc-cancel-dialog",{subscription:this.subscription,protocol:this.protocol,open:this.cancelModal,onScRequestClose:()=>this.cancelModal=!1,onScRefresh:()=>this.getSubscription()}))}get el(){return s(this)}};a.style=":host{display:block}.subscription{display:grid;gap:0.5em}.subscription a{text-decoration:none;font-weight:var(--sc-font-weight-semibold);display:inline-flex;align-items:center;gap:0.25em;color:var(--sc-color-primary-500)}.subscription a.cancel{color:var(--sc-color-danger-500)}";export{a as sc_subscription};