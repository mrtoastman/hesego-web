"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const index=require("./index-9c866aeb.js"),consumer=require("./consumer-3f5ce850.js"),index$1=require("./index-cf22257b.js"),price$1=require("./price-d3e21aa4.js"),fetch=require("./fetch-b673a242.js"),addQueryArgs=require("./add-query-args-17c551b6.js");function _defineProperties(e,i){for(var t=0;t<i.length;t++){var r=i[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,i,t){return i&&_defineProperties(e.prototype,i),t&&_defineProperties(e,t),e}function _extends(){return _extends=Object.assign||function(e){for(var i=1;i<arguments.length;i++){var t=arguments[i];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},_extends.apply(this,arguments)}function _inheritsLoose(e,i){e.prototype=Object.create(i.prototype),e.prototype.constructor=e,e.__proto__=i}function isImmutable(e){return!(!e||"function"!=typeof e.hasOwnProperty||!(e.hasOwnProperty("__ownerID")||e._map&&e._map.hasOwnProperty("__ownerID")))}function denormalizeImmutable(e,i,t){return Object.keys(e).reduce((function(i,r){var n=""+r;return i.has(n)?i.set(n,t(i.get(n),e[n])):i}),i)}var getDefaultGetId=function(e){return function(i){return isImmutable(i)?i.get(e):i[e]}},EntitySchema=function(){function e(e,i,t){if(void 0===i&&(i={}),void 0===t&&(t={}),!e||"string"!=typeof e)throw new Error("Expected a string key for Entity, but found "+e+".");var r=t,n=r.idAttribute,c=void 0===n?"id":n,o=r.mergeStrategy,s=void 0===o?function(e,i){return _extends({},e,i)}:o,a=r.processStrategy,h=void 0===a?function(e){return _extends({},e)}:a,u=r.fallbackStrategy,d=void 0===u?function(e,i){}:u;this._key=e,this._getId="function"==typeof c?c:getDefaultGetId(c),this._idAttribute=c,this._mergeStrategy=s,this._processStrategy=h,this._fallbackStrategy=d,this.define(i)}var i=e.prototype;return i.define=function(e){this.schema=Object.keys(e).reduce((function(i,t){var r,n=e[t];return _extends({},i,((r={})[t]=n,r))}),this.schema||{})},i.getId=function(e,i,t){return this._getId(e,i,t)},i.merge=function(e,i){return this._mergeStrategy(e,i)},i.fallback=function(e,i){return this._fallbackStrategy(e,i)},i.normalize=function(e,i,t,r,n,c){var o=this,s=this.getId(e,i,t),a=this.key;if(a in c||(c[a]={}),s in c[a]||(c[a][s]=[]),c[a][s].some((function(i){return i===e})))return s;c[a][s].push(e);var h=this._processStrategy(e,i,t);return Object.keys(this.schema).forEach((function(i){if(h.hasOwnProperty(i)&&"object"==typeof h[i]){var t=o.schema[i],s="function"==typeof t?t(e):t;h[i]=r(h[i],h,i,s,n,c)}})),n(this,h,e,i,t),s},i.denormalize=function(e,i){var t=this;return isImmutable(e)?denormalizeImmutable(this.schema,e,i):(Object.keys(this.schema).forEach((function(r){if(e.hasOwnProperty(r)){var n=t.schema[r];e[r]=i(e[r],n)}})),e)},_createClass(e,[{key:"key",get:function(){return this._key}},{key:"idAttribute",get:function(){return this._idAttribute}}]),e}(),PolymorphicSchema=function(){function e(e,i){i&&(this._schemaAttribute="string"==typeof i?function(e){return e[i]}:i),this.define(e)}var i=e.prototype;return i.define=function(e){this.schema=e},i.getSchemaAttribute=function(e,i,t){return!this.isSingleSchema&&this._schemaAttribute(e,i,t)},i.inferSchema=function(e,i,t){if(this.isSingleSchema)return this.schema;var r=this.getSchemaAttribute(e,i,t);return this.schema[r]},i.normalizeValue=function(e,i,t,r,n,c){var o=this.inferSchema(e,i,t);if(!o)return e;var s=r(e,i,t,o,n,c);return this.isSingleSchema||null==s?s:{id:s,schema:this.getSchemaAttribute(e,i,t)}},i.denormalizeValue=function(e,i){var t=isImmutable(e)?e.get("schema"):e.schema;return this.isSingleSchema||t?i((this.isSingleSchema?void 0:isImmutable(e)?e.get("id"):e.id)||e,this.isSingleSchema?this.schema:this.schema[t]):e},_createClass(e,[{key:"isSingleSchema",get:function(){return!this._schemaAttribute}}]),e}(),UnionSchema=function(e){function i(i,t){if(!t)throw new Error('Expected option "schemaAttribute" not found on UnionSchema.');return e.call(this,i,t)||this}_inheritsLoose(i,e);var t=i.prototype;return t.normalize=function(e,i,t,r,n,c){return this.normalizeValue(e,i,t,r,n,c)},t.denormalize=function(e,i){return this.denormalizeValue(e,i)},i}(PolymorphicSchema),ValuesSchema=function(e){function i(){return e.apply(this,arguments)||this}_inheritsLoose(i,e);var t=i.prototype;return t.normalize=function(e,i,t,r,n,c){var o=this;return Object.keys(e).reduce((function(i,t,s){var a,h=e[t];return null!=h?_extends({},i,((a={})[t]=o.normalizeValue(h,e,t,r,n,c),a)):i}),{})},t.denormalize=function(e,i){var t=this;return Object.keys(e).reduce((function(r,n){var c,o=e[n];return _extends({},r,((c={})[n]=t.denormalizeValue(o,i),c))}),{})},i}(PolymorphicSchema),validateSchema=function(e){if(Array.isArray(e)&&e.length>1)throw new Error("Expected schema definition to be a single schema, but found "+e.length+".");return e[0]},getValues=function(e){return Array.isArray(e)?e:Object.keys(e).map((function(i){return e[i]}))},normalize=function(e,i,t,r,n,c,o){return e=validateSchema(e),getValues(i).map((function(i,s){return n(i,t,r,e,c,o)}))},ArraySchema=function(e){function i(){return e.apply(this,arguments)||this}_inheritsLoose(i,e);var t=i.prototype;return t.normalize=function(e,i,t,r,n,c){var o=this;return getValues(e).map((function(e,s){return o.normalizeValue(e,i,t,r,n,c)})).filter((function(e){return null!=e}))},t.denormalize=function(e,i){var t=this;return e&&e.map?e.map((function(e){return t.denormalizeValue(e,i)})):e},i}(PolymorphicSchema),_normalize=function(e,i,t,r,n,c,o){var s=_extends({},i);return Object.keys(e).forEach((function(t){var r=e[t],a="function"==typeof r?r(i):r,h=n(i[t],i,t,a,c,o);null==h?delete s[t]:s[t]=h})),s},_denormalize=function(e,i,t){if(isImmutable(i))return denormalizeImmutable(e,i,t);var r=_extends({},i);return Object.keys(e).forEach((function(i){null!=r[i]&&(r[i]=t(r[i],e[i]))})),r},ObjectSchema=function(){function e(e){this.define(e)}var i=e.prototype;return i.define=function(e){this.schema=Object.keys(e).reduce((function(i,t){var r,n=e[t];return _extends({},i,((r={})[t]=n,r))}),this.schema||{})},i.normalize=function(){for(var e=arguments.length,i=new Array(e),t=0;t<e;t++)i[t]=arguments[t];return _normalize.apply(void 0,[this.schema].concat(i))},i.denormalize=function(){for(var e=arguments.length,i=new Array(e),t=0;t<e;t++)i[t]=arguments[t];return _denormalize.apply(void 0,[this.schema].concat(i))},e}(),visit=function e(i,t,r,n,c,o){return"object"==typeof i&&i?"object"!=typeof n||n.normalize&&"function"==typeof n.normalize?n.normalize(i,t,r,e,c,o):(Array.isArray(n)?normalize:_normalize)(n,i,t,r,e,c,o):i},addEntities=function(e){return function(i,t,r,n,c){var o=i.key,s=i.getId(r,n,c);o in e||(e[o]={});var a=e[o][s];e[o][s]=a?i.merge(a,t):t}},schema={Array:ArraySchema,Entity:EntitySchema,Object:ObjectSchema,Union:UnionSchema,Values:ValuesSchema},normalize$1=function(e,i){if(!e||"object"!=typeof e)throw new Error('Unexpected input given to normalize. Expected type to be "object", found "'+(null===e?"null":typeof e)+'".');var t={},r=addEntities(t);return{entities:t,result:visit(e,e,null,i,r,{})}};const entities={integration:new schema.Entity("integration"),account:new schema.Entity("account"),price:new schema.Entity("price"),product:new schema.Entity("product"),product_group:new schema.Entity("product_group"),purchase:new schema.Entity("purchase"),payment_method:new schema.Entity("payment_method"),card:new schema.Entity("card"),invoice:new schema.Entity("invoice"),current_period:new schema.Entity("current_period"),refund:new schema.Entity("refund"),charge:new schema.Entity("charge"),coupon:new schema.Entity("coupon"),promotion:new schema.Entity("promotion"),order:new schema.Entity("order"),customer:new schema.Entity("customer"),subscription:new schema.Entity("subscription"),product_group:new schema.Entity("product_group")},{price:price,product:product,purchase:purchase,payment_method:payment_method,card:card,invoice:invoice,refund:refund,charge:charge,coupon:coupon,promotion:promotion,order:order,integration:integration,customer:customer,product_group:product_group,subscription:subscription}=entities;product.define({prices:{data:[price]},product_group:product_group}),price.define({product:product}),invoice.define({purchases:{data:[purchase]},charge:charge,customer:customer,subscription:subscription}),order.define({purchases:{data:[purchase]},charge:charge,customer:customer,subscription:subscription}),charge.define({order:order,invoice:invoice}),subscription.define({current_period:invoice,purchase:purchase,price:price,payment_method:payment_method,order:order,customer:customer}),refund.define({charge:charge,customer:customer}),purchase.define({order:order,product:product,subscription:subscription}),payment_method.define({card:card}),coupon.define({promotions:{data:[promotion]}}),product_group.define({}),integration.define({});const normalizeEntities=e=>entities?.[e?.[0]?.object]?normalize$1(e,[entities[e?.[0]?.object]]):{},getPricesAndProducts=async({ids:e,archived:i=!1})=>{const t=await fetch.apiFetch({path:addQueryArgs.addQueryArgs("surecart/v1/prices/",{ids:e,archived:i,expand:["product"]})});return normalizePrices(t)},normalizePrices=e=>{const{entities:i}=normalizeEntities(e);return{prices:null==i?void 0:i.price,products:null==i?void 0:i.product}},scPriceChoiceCss=":host {\n  display: block;\n  min-width: 0;\n  width: 100%;\n}\n\nsc-choice-container {\n  container-type: inline-size;\n}\n\n.price-choice {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  line-height: var(--sc-line-height-dense);\n  gap: var(--sc-spacing-small);\n}\n.price-choice__name {\n  display: inline-block;\n  color: var(--sc-price-choice-name-color, var(--sc-input-label-color));\n  font-size: var(--sc-price-choice-name-size, var(--sc-input-label-font-size-medium));\n  font-weight: var(--sc-price-choice-name-font-weight, var(--sc-font-weight-bold));\n  text-transform: var(--sc-price-choice-text-transform, var(--sc-input-label-text-transform, none));\n}\n.price-choice__description {\n  color: var(--sc-input-help-text-color);\n}\n.price-choice > *:not(:first-child):last-child {\n  text-align: right;\n}\n.price-choice__details {\n  flex: 1 0 50%;\n  display: grid;\n  gap: var(--sc-spacing-xxx-small);\n}\n.price-choice__trial, .price-choice__setup-fee, .price-choice__price {\n  font-size: var(--sc-font-size-small);\n  color: var(--sc-input-help-text-color);\n}\n.price-choice__price {\n  color: var(--sc-input-label-color);\n  font-weight: var(--sc-price-choice-price-font-weight, var(--sc-font-weight-normal));\n}\n\n@container (max-width: 325px) {\n  .price-choice {\n    flex-direction: column;\n    align-items: flex-start;\n    gap: var(--sc-spacing-xx-small);\n  }\n  .price-choice > *:not(:first-child):last-child {\n    text-align: initial;\n  }\n}",ScPriceChoice=class{constructor(e){index.registerInstance(this,e),this.scUpdateLineItem=index.createEvent(this,"scUpdateLineItem",7),this.scRemoveLineItem=index.createEvent(this,"scRemoveLineItem",7),this.scAddEntities=index.createEvent(this,"scAddEntities",7),this.loading=!1,this.showLabel=!0,this.showPrice=!0,this.showControl=!0,this.prices={},this.products={},this.quantity=1,this.checked=!1,this.blank=!1}handlePriceIdChage(){var e;this.price&&(null===(e=this.price)||void 0===e?void 0:e.id)===this.priceId||this.fetchPriceWithProduct()}handlePricesChange(){var e,i,t;Object.keys(this.prices||{}).length&&Object.keys(this.products||{}).length&&(this.price=null===(e=null==this?void 0:this.prices)||void 0===e?void 0:e[this.priceId],this.product=null===(i=null==this?void 0:this.products)||void 0===i?void 0:i[null===(t=null==this?void 0:this.price)||void 0===t?void 0:t.product])}handlePriseChange(){var e;this.isAdHoc=null===(e=null==this?void 0:this.price)||void 0===e?void 0:e.ad_hoc}handleErrorsChange(){var e;const i=((null===(e=null==this?void 0:this.error)||void 0===e?void 0:e.additional_errors)||[]).find((e=>{var i;return"line_items.ad_hoc_amount"===(null===(i=null==e?void 0:e.data)||void 0===i?void 0:i.attribute)}));this.adHocErrorMessage=(null==i?void 0:i.message)?null==i?void 0:i.message:""}handleCheckedChange(){var e;(null===(e=this.price)||void 0===e?void 0:e.ad_hoc)&&this.choice.checked&&setTimeout((()=>{this.adHocInput.triggerFocus()}),50)}componentWillLoad(){this.price||this.fetchPriceWithProduct()}async fetchPriceWithProduct(){if(this.priceId)try{this.loading=!0;const{products:e,prices:i}=await getPricesAndProducts({archived:!1,ids:[this.priceId]});this.scAddEntities.emit({prices:i,products:e})}catch(e){}finally{this.loading=!1}}isInOrder(){return index$1.isPriceInOrder(this.price,this.order)}isChecked(){return this.isInOrder()}onChangeAdHoc(e){this.scUpdateLineItem.emit({price_id:this.priceId,quantity:this.quantity,ad_hoc_amount:e.target.value})}getLineItem(){var e,i;return((null===(i=null===(e=this.order)||void 0===e?void 0:e.line_items)||void 0===i?void 0:i.data)||[]).find((e=>e.price.id===this.priceId))}showAdHoc(){var e,i;return!!(null===(e=this.price)||void 0===e?void 0:e.ad_hoc)&&(!!this.isInOrder()||(null===(i=null==this?void 0:this.choice)||void 0===i?void 0:i.checked))}renderEmpty(){var e;return(null===(e=null===window||void 0===window?void 0:window.wp)||void 0===e?void 0:e.blocks)?index.h("sc-alert",{type:"danger",open:!0,style:{margin:"0px"}},wp.i18n.__("This product has been archived.","surecart")):index.h(index.Host,{style:{display:"none"}})}renderPrice(){return index.h(index.Fragment,null,index.h("sc-format-number",{type:"currency",value:this.price.amount,currency:this.price.currency}),price$1.intervalString(this.price,{showOnce:!0,abbreviate:!0,labels:{interval:"/",period:
/** translators: used as in time period: "for 3 months" */
wp.i18n.__("for","surecart")}}))}render(){var e,i,t,r,n,c,o;return this.loading?index.h("sc-choice-container",{showControl:this.showControl,name:"loading",disabled:!0},index.h("div",{class:"price-choice"},index.h("sc-skeleton",{style:{width:"60px",display:"inline-block"}}),index.h("sc-skeleton",{style:{width:"80px",display:"inline-block"}}))):!(null===(e=null==this?void 0:this.price)||void 0===e?void 0:e.id)||(null===(i=this.price)||void 0===i?void 0:i.archived)||(null===(t=this.product)||void 0===t?void 0:t.archived)?this.renderEmpty():index.h("sc-choice-container",{ref:e=>this.choice=e,value:this.priceId,type:this.type,showControl:this.showControl,checked:this.isChecked()},index.h("div",{class:"price-choice"},this.showLabel&&index.h("div",{class:"price-choice__title"},index.h("div",{class:"price-choice__name"},this.label||(null===(r=null==this?void 0:this.price)||void 0===r?void 0:r.name)||(null===(n=null==this?void 0:this.product)||void 0===n?void 0:n.name)),!!this.description&&index.h("div",{class:"price-choice__description"},this.description)),this.showPrice&&index.h("div",{class:"price-choice__details"},index.h("div",{class:"price-choice__price"},(null===(c=this.price)||void 0===c?void 0:c.ad_hoc)?wp.i18n.__("Custom Amount","surecart"):index.h(index.Fragment,null,index.h("sc-format-number",{type:"currency",value:this.price.amount,currency:this.price.currency}),price$1.intervalString(this.price,{showOnce:!0,abbreviate:!0,labels:{interval:"/",period:
/** translators: used as in time period: "for 3 months" */
wp.i18n.__("for","surecart")}}))),!!this.price.trial_duration_days&&index.h("div",{class:"price-choice__trial"},wp.i18n.sprintf(wp.i18n._n("Starting in %s day","Starting in %s days",this.price.trial_duration_days,"surecart"),this.price.trial_duration_days)),!!this.price.setup_fee_enabled&&(null===(o=this.price)||void 0===o?void 0:o.setup_fee_amount)&&index.h("div",{class:"price-choice__setup-fee"},index.h("sc-format-number",{type:"currency",value:this.price.setup_fee_amount,currency:this.price.currency})," ",this.price.setup_fee_name||wp.i18n.__("Setup Fee","surecart")))))}static get watchers(){return{priceId:["handlePriceIdChage"],prices:["handlePricesChange"],products:["handlePricesChange"],price:["handlePriseChange"],error:["handleErrorsChange"],checked:["handleCheckedChange"]}}};consumer.openWormhole(ScPriceChoice,["prices","products","order","error"],!1),ScPriceChoice.style=scPriceChoiceCss,exports.sc_price_choice=ScPriceChoice;