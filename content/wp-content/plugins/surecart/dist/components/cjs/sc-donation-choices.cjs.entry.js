"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const index=require("./index-9c866aeb.js"),consumer=require("./consumer-3f5ce850.js"),scDonationChoicesCss=":host{display:block}.sc-donation-choices{display:grid;gap:var(--sc-spacing-small);position:relative}.sc-donation-choices__form{display:grid;gap:var(--sc-spacing-small)}",ScDonationChoices=class{constructor(e){index.registerInstance(this,e),this.scRemoveLineItem=index.createEvent(this,"scRemoveLineItem",7),this.scUpdateLineItem=index.createEvent(this,"scUpdateLineItem",7),this.scAddLineItem=index.createEvent(this,"scAddLineItem",7),this.currencyCode="usd",this.lineItems=[],this.removeInvalid=!0}async reportValidity(){return!this.input||this.input.shadowRoot.querySelector("sc-input").reportValidity()}handleChange(){const e=Array.from(this.getChoices()).find((e=>e.checked));this.showCustomAmount="ad_hoc"===e.value,isNaN(parseInt(e.value))||this.scUpdateLineItem.emit({price_id:this.priceId,quantity:1,ad_hoc_amount:parseInt(e.value)})}handleCustomAmountToggle(e){e&&setTimeout((()=>{var e,i;null===(i=null===(e=this.input)||void 0===e?void 0:e.triggerFocus)||void 0===i||i.call(e)}),50)}handleLineItemsChange(){var e;(null===(e=this.lineItems)||void 0===e?void 0:e.length)&&(this.lineItem=(this.lineItems||[]).find((e=>e.price.id===this.priceId)))}handleLineItemChange(e){this.removeInvalid&&this.removeInvalidPrices();const i=this.getChoices();let t=!1;i.forEach((i=>{isNaN(parseInt(i.value))||i.disabled||(parseInt(i.value)===(null==e?void 0:e.ad_hoc_amount)?(i.checked=!0,t=!0):i.checked=!1)})),this.showCustomAmount=!t,t||(this.el.querySelector('sc-choice[value="ad_hoc"]').checked=!0)}componentWillLoad(){this.handleLineItemsChange()}selectDefaultChoice(){const e=this.getChoices();e.length&&(e[0].checked=!0)}getChoices(){return this.el.querySelectorAll("sc-choice")||[]}removeInvalidPrices(){this.lineItem&&this.getChoices().forEach((e=>{var i,t,n,s,o,l,c,d;return(null===(t=null===(i=this.lineItem)||void 0===i?void 0:i.price)||void 0===t?void 0:t.ad_hoc_max_amount)&&parseInt(e.value)>(null===(s=null===(n=this.lineItem)||void 0===n?void 0:n.price)||void 0===s?void 0:s.ad_hoc_max_amount)||(null===(l=null===(o=this.lineItem)||void 0===o?void 0:o.price)||void 0===l?void 0:l.ad_hoc_min_amount)&&parseInt(e.value)<(null===(d=null===(c=this.lineItem)||void 0===c?void 0:c.price)||void 0===d?void 0:d.ad_hoc_min_amount)?(e.style.display="none",void(e.disabled=!0)):(e.style.display="flex",void(e.disabled=!1))}))}updateCustomAmount(){var e,i,t;this.input.value!==(null===(t=null===(i=null===(e=this.lineItem)||void 0===e?void 0:e.ad_hoc_amount)||void 0===i?void 0:i.toString)||void 0===t?void 0:t.call(i))&&(this.input.value?this.scUpdateLineItem.emit({price_id:this.priceId,quantity:1,ad_hoc_amount:parseInt(this.input.value)}):this.scRemoveLineItem.emit({price_id:this.priceId,quantity:1}))}render(){var e,i,t;return this.loading?index.h("div",{class:"sc-donation-choices"},index.h("sc-skeleton",{style:{width:"20%",display:"inline-block"}}),index.h("sc-skeleton",{style:{width:"60%",display:"inline-block"}}),index.h("sc-skeleton",{style:{width:"40%",display:"inline-block"}})):index.h("div",{class:"sc-donation-choices"},index.h("sc-choices",{label:this.label,"auto-width":!0},index.h("slot",null)),this.showCustomAmount&&index.h("div",{class:"sc-donation-choices__form"},index.h("sc-price-input",{ref:e=>this.input=e,required:!0,currencyCode:this.currencyCode,label:"Enter an amount",value:null===(t=null===(i=null===(e=this.lineItem)||void 0===e?void 0:e.ad_hoc_amount)||void 0===i?void 0:i.toString)||void 0===t?void 0:t.call(i)}),index.h("sc-button",{type:"primary",onClick:()=>this.updateCustomAmount(),full:!0,busy:this.busy},wp.i18n.__("Update","surecart"))),this.busy&&index.h("sc-block-ui",{style:{zIndex:"9"}}))}get el(){return index.getElement(this)}static get watchers(){return{showCustomAmount:["handleCustomAmountToggle"],lineItems:["handleLineItemsChange"],lineItem:["handleLineItemChange"]}}};consumer.openWormhole(ScDonationChoices,["lineItems","loading","busy","currencyCode"],!1),ScDonationChoices.style=scDonationChoicesCss,exports.sc_donation_choices=ScDonationChoices;