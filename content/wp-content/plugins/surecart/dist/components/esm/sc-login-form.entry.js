import{r as registerInstance,h,F as Fragment}from"./index-fd4790f6.js";import{a as apiFetch}from"./fetch-34712ac6.js";import"./add-query-args-f4c5962b.js";const scLoginFormCss=".login-form{font-size:16px;margin:var(--sc-spacing-xx-large) auto;max-width:400px;position:relative}.login-form__title{margin-bottom:var(--sc-spacing-medium);font-size:var(--sc-font-size-xx-large);font-weight:var(--sc-font-weight-bold);line-height:var(--sc-line-height-dense);text-align:var(--sc-login-text-align, center)}.login-form__back{text-align:center;font-size:var(--sc-font-size-small)}sc-card{--sc-card-padding:var(--sc-spacing-xx-large)}",ScLogin=class{constructor(i){registerInstance(this,i),this.step=0,this.email="",this.password="",this.verifyCode=""}handleStepChange(){1===this.step&&setTimeout((()=>{var i,t;null===(t=null===(i=this.passwordInput)||void 0===i?void 0:i.triggerFocus)||void 0===t||t.call(i)}),50),2===this.step&&setTimeout((()=>{var i,t;null===(t=null===(i=this.codeInput)||void 0===i?void 0:i.triggerFocus)||void 0===t||t.call(i)}),50)}handleLoadingChange(i){i&&(this.error=null)}handleVerifyCodeChange(i){(null==i?void 0:i.length)>=6&&this.submitCode()}handleError(i){console.error(this.error),this.error=i||{message:wp.i18n.__("Something went wrong","surecart")}}async createLoginCode(){try{this.loading=!0,await apiFetch({method:"POST",path:"surecart/v1/verification_codes",data:{login:this.email}}),this.step=this.step+1}catch(i){this.handleError(i)}finally{this.loading=!1}}async submitCode(){try{this.loading=!0;const{verified:i}=await apiFetch({method:"POST",path:"surecart/v1/verification_codes/verify",data:{login:this.email,code:this.verifyCode}});if(!i)throw{message:wp.i18n.__("Verification code is not valid. Please try again.","surecart")};window.location.reload()}catch(i){this.handleError(i),this.loading=!1}}async login(){try{this.loading=!0;const{redirect_url:i}=await apiFetch({method:"POST",path:"surecart/v1/login",data:{login:this.email,password:this.password}});i?window.location.replace(i):window.location.reload()}catch(i){this.handleError(i),this.loading=!1}}async checkEmail(){try{this.loading=!0,await apiFetch({method:"POST",path:"surecart/v1/check_email",data:{login:this.email}}),this.step=this.step+1}catch(i){this.handleError(i)}finally{this.loading=!1}}renderInner(){return 2===this.step?h(Fragment,null,h("div",{class:"login-form__title",part:"title"},wp.i18n.__("Check your email for a confirmation code","surecart")),h("div",null,h("sc-form",{onScFormSubmit:()=>this.submitCode()},h("sc-input",{label:wp.i18n.__("Confirmation code","surecart"),type:"text",ref:i=>this.codeInput=i,autofocus:!0,required:!0,onScInput:i=>this.verifyCode=i.target.value}),h("sc-button",{type:"primary",submit:!0,full:!0},h("sc-icon",{name:"lock",slot:"prefix"}),wp.i18n.__("Login with Code","surecart"))))):1===this.step&&this.email?h(Fragment,null,h("div",{class:"login-form__title",part:"title"},h("div",null,wp.i18n.__("Welcome","surecart")),h("sc-button",{style:{fontSize:"18px"},size:"small",pill:!0,caret:!0,onClick:()=>this.step=this.step-1},h("sc-icon",{name:"user",slot:"prefix"}),this.email)),h("sc-flex",{flexDirection:"column",style:{"--sc-flex-column-gap":"var(--sc-spacing-large)"}},h("div",null,h("sc-form",{onScFormSubmit:()=>this.createLoginCode()},h("sc-button",{class:"login-code",type:"primary",submit:!0,full:!0},h("sc-icon",{name:"mail",slot:"prefix"}),wp.i18n.__("Send a login code","surecart"))),h("sc-divider",{style:{"--spacing":"0.5em"}},wp.i18n.__("or","surecart")),h("sc-form",{onScFormSubmit:()=>this.login()},h("sc-input",{label:wp.i18n.__("Enter your password","surecart"),type:"password",ref:i=>this.passwordInput=i,onKeyDown:i=>"Enter"===i.key&&this.login(),autofocus:!0,required:!0,onScInput:i=>this.password=i.target.value}),h("sc-button",{type:"primary",outline:!0,submit:!0,full:!0},h("sc-icon",{name:"lock",slot:"prefix"}),wp.i18n.__("Login","surecart")))))):h(Fragment,null,h("div",{class:"login-form__title",part:"title"},h("slot",{name:"title"})),h("sc-form",{onScFormSubmit:()=>this.checkEmail()},h("sc-input",{type:"text",value:this.email,label:wp.i18n.__("Username or Email Address","surecart"),onScInput:i=>this.email=i.target.value,onKeyDown:i=>"Enter"===i.key&&this.checkEmail(),required:!0,autofocus:!0}),h("sc-button",{type:"primary",submit:!0,full:!0},h("sc-icon",{name:"arrow-right",slot:"suffix"}),wp.i18n.__("Next","surecart"))))}render(){var i,t;return h("div",{class:"login-form"},h("sc-card",null,!!this.error&&h("sc-alert",{open:!0,type:"danger",closable:!0,onScHide:()=>this.error=null},h("span",{slot:"title",innerHTML:null===(i=this.error)||void 0===i?void 0:i.message}),((null===(t=this.error)||void 0===t?void 0:t.additional_errors)||[]).map((({message:i})=>h("div",{innerHTML:i})))),this.renderInner()),this.loading&&h("sc-block-ui",{spinner:!0,style:{zIndex:"9","--sc-block-ui-opacity":"0.5"}}))}static get watchers(){return{step:["handleStepChange"],loading:["handleLoadingChange"],verifyCode:["handleVerifyCodeChange"]}}};ScLogin.style=scLoginFormCss;export{ScLogin as sc_login_form};