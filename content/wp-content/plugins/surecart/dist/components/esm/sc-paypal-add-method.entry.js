import{r as registerInstance,h,H as Host}from"./index-fd4790f6.js";import{l as loadScript,g as getScriptLoadParams}from"./functions-b67a547b.js";import{a as apiFetch}from"./fetch-34712ac6.js";import"./add-query-args-f4c5962b.js";const scPaypalAddMethodCss=':host{display:block}.paypal-buttons{position:relative;line-height:0;text-align:center}.paypal-buttons:after{content:" ";border-bottom:1px solid var(--sc-input-border-color);width:100%;height:0;top:50%;left:0;right:0;position:absolute}',ScPaypalAddMethod=class{constructor(t){registerInstance(this,t),this.liveMode=!0}componentWillLoad(){this.createPaymentIntent()}async handlePaymentIntentCreate(){var t,e;const{external_intent_id:a}=this.paymentIntent||{},{client_id:r,account_id:n,merchant_initiated:i}=(null===(e=null===(t=this.paymentIntent)||void 0===t?void 0:t.processor_data)||void 0===e?void 0:e.paypal)||{};if(r&&n&&a&&!this.paypal)try{this.paypal=await loadScript(getScriptLoadParams({clientId:r,merchantId:n,merchantInitiated:i,reusable:!0})),this.paypal.Buttons({onInit:()=>{this.loaded=!0},createBillingAgreement:()=>new Promise((t=>t(a))),onApprove:async()=>{var t;try{this.loading=!0;const e=await apiFetch({method:"PATCH",path:`surecart/v1/payment_intents/${null===(t=this.paymentIntent)||void 0===t?void 0:t.id}/capture`});if(!["succeeded","pending","requires_approval"].includes(null==e?void 0:e.status))throw{message:wp.i18n.__("The payment did not process. Please try again.","surecart")};window.location.assign(this.successUrl)}catch(t){console.error(t),this.error=(null==t?void 0:t.message)||wp.i18n.__("The payment did not process. Please try again.","surecart"),this.loading=!1}},onError:t=>{console.error(t),alert((null==t?void 0:t.message)||wp.i18n.__("The payment did not process. Please try again.","surecart"))}}).render(this.container)}catch(t){console.error("Failed to load the PayPal JS SDK script",t),this.error=wp.i18n.__("Failed to load the PayPal JS SDK script","surecart")}}async createPaymentIntent(){var t,e;try{this.loading=!0,this.error="",this.paymentIntent=await apiFetch({method:"POST",path:"surecart/v1/payment_intents",data:{processor_type:"paypal",reusable:!0,live_mode:this.liveMode,customer_id:this.customerId,currency:this.currency}})}catch(a){this.error=(null===(e=null===(t=null==a?void 0:a.additional_errors)||void 0===t?void 0:t[0])||void 0===e?void 0:e.message)||(null==a?void 0:a.message)||wp.i18n.__("Something went wrong","surecart")}finally{this.loading=!1}}render(){return h(Host,null,this.error&&h("sc-alert",{open:!!this.error,type:"danger"},h("span",{slot:"title"},wp.i18n.__("Error","surecart")),this.error),h("div",{class:"sc-paypal-button-container",hidden:!this.loaded,ref:t=>this.container=t}))}static get watchers(){return{paymentIntent:["handlePaymentIntentCreate"]}}};ScPaypalAddMethod.style=scPaypalAddMethodCss;export{ScPaypalAddMethod as sc_paypal_add_method};