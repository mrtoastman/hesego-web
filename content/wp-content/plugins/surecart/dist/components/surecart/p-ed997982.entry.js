import{r as i,h as t,F as s,g as n}from"./p-dfbe004d.js";import{a as l}from"./p-d8453138.js";import{o}from"./p-c2833cb1.js";import{i as e}from"./p-468023a1.js";import{a as r}from"./p-1c2e2695.js";const d=class{constructor(t){i(this,t),this.filterAbove=4,this.products=[],this.filter="month"}componentWillLoad(){o(this.el,(async()=>{try{this.loading=!0,await Promise.all([this.getGroup(),this.getProductPrices()])}catch(i){console.error(i),this.error=(null==i?void 0:i.message)?i.message:wp.i18n.__("Something went wrong","surecart")}finally{this.loading=!1}})),this.handleSubscriptionChange()}handleProductsChange(){var i;this.prices=this.products.map((i=>{var t,e;return null===(e=null===(t=i)||void 0===t?void 0:t.prices)||void 0===e?void 0:e.data})).flat().filter(((i,t,e)=>e.findIndex((t=>t.id===i.id))===t)).filter((i=>!(null==i?void 0:i.archived))),this.showFilters=(null===(i=this.prices)||void 0===i?void 0:i.length)>this.filterAbove}handlePricesChange(i,t){!(null==t?void 0:t.length)&&(null==i?void 0:i.length)&&(this.selectedPrice=i.find((i=>{var t,e;return i.id===(null===(e=null===(t=this.subscription)||void 0===t?void 0:t.price)||void 0===e?void 0:e.id)}))),this.hasFilters={...this.hasFilters,split:this.prices.some((i=>"month"===i.recurring_interval&&(null==i?void 0:i.recurring_period_count)&&!(null==i?void 0:i.archived))),month:this.prices.some((i=>"month"===i.recurring_interval&&!(null==i?void 0:i.recurring_period_count)&&!(null==i?void 0:i.archived))),year:this.prices.some((i=>"year"===i.recurring_interval&&!(null==i?void 0:i.archived))),never:this.prices.some((i=>!("never"!==i.recurring_interval&&i.recurring_interval||(null==i?void 0:i.archived))))}}handleSubscriptionChange(){var i,t;this.filter=(null===(t=null===(i=this.subscription)||void 0===i?void 0:i.price)||void 0===t?void 0:t.recurring_interval)||"month"}async getGroup(){if(!this.productGroupId)return;const i=await await l({path:r("surecart/v1/products/",{product_group_ids:[this.productGroupId],expand:["prices"],...this.query})});this.products=[...this.products,...i]}async getProductPrices(){if(!this.productId)return;const i=await await l({path:r(`surecart/v1/products/${this.productId}`,{expand:["prices"]})});this.products=[...this.products,i]}async handleSubmit(i){var t;const{plan:e}=await i.target.getFormJson(),s=this.prices.find((i=>i.id===e)),n=null===(t=this.subscription)||void 0===t?void 0:t.price;if((null==s?void 0:s.id)!==n.id||(null==s?void 0:s.ad_hoc)){if(null==s?void 0:s.ad_hoc)return this.busy=!0,window.location.assign(r(window.location.href,{action:"confirm_amount",price_id:e}));this.busy=!0,window.location.assign(r(window.location.href,{action:"confirm",price_id:e}))}}renderSwitcher(){if(Object.values(this.hasFilters||{}).filter((i=>!!i)).length>1&&this.showFilters)return t("sc-flex",{slot:"end",class:"subscriptions-switch__switcher"},this.hasFilters.month&&t("sc-button",{onClick:()=>this.filter="month",size:"small",type:"month"===this.filter?"default":"text"},wp.i18n.__("Monthly","surecart")),this.hasFilters.week&&t("sc-button",{onClick:()=>this.filter="week",size:"small",type:"week"===this.filter?"default":"text"},wp.i18n.__("Weekly","surecart")),this.hasFilters.year&&t("sc-button",{onClick:()=>this.filter="year",size:"small",type:"year"===this.filter?"default":"text"},wp.i18n.__("Yearly","surecart")),this.hasFilters.never&&t("sc-button",{onClick:()=>this.filter="never",size:"small",type:"never"===this.filter?"default":"text"},wp.i18n.__("Lifetime","surecart")),this.hasFilters.split&&t("sc-button",{onClick:()=>this.filter="split",size:"small",type:"split"===this.filter?"default":"text"},wp.i18n.__("Payment Plan","surecart")))}renderLoading(){return t("sc-choice",{name:"loading",disabled:!0},t("sc-skeleton",{style:{width:"60px",display:"inline-block"}}),t("sc-skeleton",{style:{width:"80px",display:"inline-block"},slot:"price"}),t("sc-skeleton",{style:{width:"120px",display:"inline-block"},slot:"description"}))}isHidden(i){if(!this.showFilters)return!1;let t=this.filter!==i.recurring_interval;return"never"!==this.filter||(null==i?void 0:i.recurring_interval)||(t=!1),"split"===this.filter&&(null==i?void 0:i.recurring_period_count)&&(t=!1),t}renderContent(){return this.loading?this.renderLoading():t("sc-choices",{required:!0},t("div",null,(this.prices||[]).filter((i=>!i.archived)).filter((i=>{var t;return(null==i?void 0:i.currency)===(null===(t=this.subscription)||void 0===t?void 0:t.currency)})).map((i=>{var r,n;const l=(null===(n=null===(r=this.subscription)||void 0===r?void 0:r.price)||void 0===n?void 0:n.id)===(null==i?void 0:i.id),o=this.products.find((t=>t.id===(null==i?void 0:i.product)));return t("sc-choice",{key:null==i?void 0:i.id,checked:l,name:"plan",value:null==i?void 0:i.id,hidden:this.isHidden(i),onScChange:t=>{t.detail&&(this.selectedPrice=this.prices.find((t=>t.id===(null==i?void 0:i.id))))}},t("div",null,t("strong",null,(null==i?void 0:i.name)||(null==o?void 0:o.name))),t("div",{slot:"description"},(null==i?void 0:i.ad_hoc)?`${wp.i18n.__("Custom amount","surecart")} ${e(i)}`:t(s,null,t("sc-format-number",{type:"currency",currency:(null==i?void 0:i.currency)||"usd",value:null==i?void 0:i.amount})," ",e(i,{showOnce:!0}))),l&&t("sc-tag",{type:"warning",slot:"price"},wp.i18n.__("Current Plan","surecart")))}))))}buttonText(){var i,t,e,r;return(null===(i=this.selectedPrice)||void 0===i?void 0:i.ad_hoc)?(null===(t=this.selectedPrice)||void 0===t?void 0:t.id)===(null===(r=null===(e=this.subscription)||void 0===e?void 0:e.price)||void 0===r?void 0:r.id)?wp.i18n.__("Update Amount","surecart"):wp.i18n.__("Choose Amount","surecart"):wp.i18n.__("Next","surecart")}render(){var i,e,r,s,n,l,o,d;return!this.loading&&(null===(i=this.prices)||void 0===i?void 0:i.length)<2&&!(null===(r=null===(e=this.prices)||void 0===e?void 0:e[0])||void 0===r?void 0:r.ad_hoc)?null:(null===(s=this.subscription)||void 0===s?void 0:s.finite)?t("sc-alert",{type:"info",open:!0},wp.i18n.__("To make changes to your payment plan, please contact us.","surecart")):t("sc-dashboard-module",{heading:this.heading||wp.i18n.__("Update Plan","surecart"),class:"subscription-switch",error:this.error},t("span",{slot:"end"},this.renderSwitcher()),t("sc-form",{class:"subscriptions-switch",onScFormSubmit:i=>this.handleSubmit(i)},this.renderContent(),t("sc-button",{type:"primary",full:!0,submit:!0,loading:this.loading||this.busy,disabled:(null===(l=null===(n=this.subscription)||void 0===n?void 0:n.price)||void 0===l?void 0:l.id)===(null===(o=this.selectedPrice)||void 0===o?void 0:o.id)&&!(null===(d=this.selectedPrice)||void 0===d?void 0:d.ad_hoc)},this.buttonText()," ",t("sc-icon",{name:"arrow-right",slot:"suffix"})),this.busy&&t("sc-block-ui",{style:{zIndex:"9"}})))}get el(){return n(this)}static get watchers(){return{products:["handleProductsChange"],prices:["handlePricesChange"],subscription:["handleSubscriptionChange"]}}};d.style=":host{display:block;position:relative}[hidden]{display:none !important}.subscriptions-switch{display:grid;gap:0.5em}.subscriptions-switch__switcher{background:rgba(0, 0, 0, 0.035);padding:2px;line-height:1;border-radius:var(--sc-border-radius-small)}";export{d as sc_subscription_switch};