"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const index=require("./index-9c866aeb.js"),fetch=require("./fetch-b673a242.js"),price=require("./price-d3e21aa4.js"),tax=require("./tax-39abdb3c.js"),addQueryArgs=require("./add-query-args-17c551b6.js"),scCancelDialogCss=":host{display:block;font-size:var(--sc-font-size-medium)}.close__button{position:absolute;top:0;right:0;font-size:22px}",ScCancelDialog=class{constructor(e){index.registerInstance(this,e),this.scRequestClose=index.createEvent(this,"scRequestClose",7),this.scRefresh=index.createEvent(this,"scRefresh",7),this.step="cancel"}close(){this.reset(),this.trackAttempt(),this.scRequestClose.emit("close-button")}reset(){var e;this.reason=null,this.step=(null===(e=this.protocol)||void 0===e?void 0:e.preservation_enabled)?"survey":"cancel"}async trackAttempt(){var e,i;(null===(e=this.protocol)||void 0===e?void 0:e.preservation_enabled)&&await fetch.apiFetch({method:"PATCH",path:`surecart/v1/subscriptions/${null===(i=this.subscription)||void 0===i?void 0:i.id}/preserve`})}componentWillLoad(){this.reset()}render(){return index.h("sc-dialog",{style:{"--width":"survey"===this.step?"675px":"500px","--body-spacing":"var(--sc-spacing-xxx-large)"},noHeader:!0,open:this.open,onScRequestClose:()=>this.close()},index.h("div",{class:{cancel:!0}},index.h("sc-button",{class:"close__button",type:"text",circle:!0,onClick:()=>this.close()},index.h("sc-icon",{name:"x"})),"cancel"===this.step&&index.h("sc-subscription-cancel",{subscription:this.subscription,protocol:this.protocol,reason:this.reason,comment:this.comment,onScAbandon:()=>this.close(),onScCancelled:()=>{this.scRefresh.emit(),this.reset(),this.scRequestClose.emit("close-button")}}),"survey"===this.step&&index.h("sc-cancel-survey",{protocol:this.protocol,onScAbandon:()=>this.close(),onScSubmitReason:e=>{const{comment:i,reason:t}=e.detail;this.reason=t,this.comment=i,this.step=(null==t?void 0:t.coupon_enabled)?"discount":"cancel"}}),"discount"===this.step&&index.h("sc-cancel-discount",{protocol:this.protocol,subscription:this.subscription,reason:this.reason,comment:this.comment,onScCancel:()=>this.step="cancel",onScPreserved:()=>{this.scRefresh.emit(),this.reset(),this.scRequestClose.emit("close-button")}})))}};ScCancelDialog.style=scCancelDialogCss;const ScSubscriptionNextPayment=class{constructor(e){index.registerInstance(this,e),this.loading=!0}componentWillLoad(){this.fetch()}handleSubscriptionChange(){this.fetch()}async fetch(){var e,i,t;if((null===(e=this.subscription)||void 0===e?void 0:e.cancel_at_period_end)&&this.subscription.current_period_end_at)this.loading=!1;else if("canceled"!==(null===(i=this.subscription)||void 0===i?void 0:i.status))try{this.loading=!0,this.period=await fetch.apiFetch({method:"PATCH",path:addQueryArgs.addQueryArgs(`surecart/v1/subscriptions/${null===(t=this.subscription)||void 0===t?void 0:t.id}/upcoming_period`,{skip_product_group_validation:!0,expand:["period.checkout","checkout.line_items","checkout.payment_method","payment_method.card","payment_method.payment_instrument","payment_method.paypal_account","payment_method.bank_account","line_item.price","price.product","period.subscription"]}),data:{purge_pending_update:!1}})}catch(e){console.error(e),this.error=e}finally{this.loading=!1}else this.loading=!1}render(){var e,i,t,n;if(this.loading)return index.h("sc-toggle",{borderless:!0,disabled:!0},index.h("sc-flex",{slot:"summary",flexDirection:"column"},index.h("sc-skeleton",{style:{width:"200px"}}),index.h("sc-skeleton",{style:{width:"400px"}}),index.h("sc-skeleton",{style:{width:"300px"}})));const s=null===(e=null==this?void 0:this.period)||void 0===e?void 0:e.checkout;return s?index.h(index.Host,null,index.h("sc-toggle",{borderless:!0,shady:!0},index.h("span",{slot:"summary"},index.h("sc-subscription-details",{subscription:this.subscription},index.h("div",{style:{fontSize:"var(--sc-font-size-small)"}},wp.i18n.__("Your next payment is","surecart")," ",index.h("strong",null,index.h("sc-format-number",{type:"currency",currency:null==s?void 0:s.currency,value:null==s?void 0:s.amount_due}))," ",!!(null===(i=this.subscription)||void 0===i?void 0:i.finite)&&" - "+price.translateRemainingPayments(null===(t=this.subscription)||void 0===t?void 0:t.remaining_period_count)))),index.h("sc-card",{noPadding:!0,borderless:!0},null===(n=null==s?void 0:s.line_items)||void 0===n?void 0:n.data.map((e=>{var i,t,n,s,o;return index.h("sc-product-line-item",{imageUrl:null===(t=null===(i=e.price)||void 0===i?void 0:i.product)||void 0===t?void 0:t.image_url,name:null===(s=null===(n=e.price)||void 0===n?void 0:n.product)||void 0===s?void 0:s.name,editable:!1,removable:!1,quantity:null==e?void 0:e.quantity,amount:null==e?void 0:e.total_amount,currency:null===(o=null==e?void 0:e.price)||void 0===o?void 0:o.currency,interval:price.intervalString(null==e?void 0:e.price)})})),index.h("sc-line-item",null,index.h("span",{slot:"description"},wp.i18n.__("Subtotal","surecart")),index.h("sc-format-number",{slot:"price",type:"currency",currency:null==s?void 0:s.currency,value:null==s?void 0:s.subtotal_amount})),!!s.proration_amount&&index.h("sc-line-item",null,index.h("span",{slot:"description"},wp.i18n.__("Proration Credit","surecart")),index.h("sc-format-number",{slot:"price",type:"currency",currency:null==s?void 0:s.currency,value:-(null==s?void 0:s.proration_amount)})),!!s.applied_balance_amount&&index.h("sc-line-item",null,index.h("span",{slot:"description"},wp.i18n.__("Applied Balance","surecart")),index.h("sc-format-number",{slot:"price",type:"currency",currency:null==s?void 0:s.currency,value:-(null==s?void 0:s.applied_balance_amount)})),!!s.trial_amount&&index.h("sc-line-item",null,index.h("span",{slot:"description"},wp.i18n.__("Free Trial","surecart")),index.h("sc-format-number",{slot:"price",type:"currency",currency:null==s?void 0:s.currency,value:null==s?void 0:s.trial_amount})),!!(null==s?void 0:s.discount_amount)&&index.h("sc-line-item",null,index.h("span",{slot:"description"},wp.i18n.__("Discounts","surecart")),index.h("sc-format-number",{slot:"price",type:"currency",currency:null==s?void 0:s.currency,value:null==s?void 0:s.discount_amount})),!!s.tax_amount&&index.h("sc-line-item",null,index.h("span",{slot:"description"},tax.formatTaxDisplay(null==s?void 0:s.tax_label)),index.h("sc-format-number",{slot:"price",type:"currency",currency:null==s?void 0:s.currency,value:null==s?void 0:s.tax_amount})),index.h("sc-divider",{style:{"--spacing":"0"}}),index.h("sc-line-item",null,index.h("span",{slot:"description"},wp.i18n.__("Payment","surecart")),index.h("a",{href:addQueryArgs.addQueryArgs(window.location.href,{action:"update_payment_method"}),slot:"price-description"},index.h("sc-flex",{"justify-content":"flex-start","align-items":"center",style:{"--spacing":"0.5em"}},index.h("sc-payment-method",{paymentMethod:null==s?void 0:s.payment_method}),index.h("sc-icon",{name:"edit-3"})))),index.h("sc-line-item",{style:{"--price-size":"var(--sc-font-size-x-large)"}},index.h("span",{slot:"title"},wp.i18n.__("Total Due","surecart")),index.h("sc-format-number",{slot:"price",type:"currency",currency:null==s?void 0:s.currency,value:null==s?void 0:s.amount_due}),index.h("span",{slot:"currency"},s.currency))))):index.h("div",{style:{padding:"var(--sc-spacing-medium)"}},index.h("sc-subscription-details",{slot:"summary",subscription:this.subscription}))}static get watchers(){return{subscription:["handleSubscriptionChange"]}}};exports.sc_cancel_dialog=ScCancelDialog,exports.sc_subscription_next_payment=ScSubscriptionNextPayment;