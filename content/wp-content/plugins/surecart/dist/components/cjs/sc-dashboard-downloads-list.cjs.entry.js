"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const index=require("./index-9c866aeb.js"),fetch=require("./fetch-b673a242.js"),lazy=require("./lazy-bc8baeab.js"),addQueryArgs=require("./add-query-args-17c551b6.js"),scDashboardDownloadsListCss=":host{display:block}.download__details{opacity:0.75}",ScDownloadsList=class{constructor(e){index.registerInstance(this,e),this.query={page:1,per_page:10},this.purchases=[],this.pagination={total:0,total_pages:0}}componentWillLoad(){lazy.onFirstVisible(this.el,(()=>{this.initialFetch()}))}async initialFetch(){if(this.isCustomer)try{this.loading=!0,await this.getItems()}catch(e){console.error(this.error),this.error=(null==e?void 0:e.message)||wp.i18n.__("Something went wrong","surecart")}finally{this.loading=!1}}async fetchItems(){if(this.isCustomer)try{this.busy=!0,await this.getItems()}catch(e){console.error(this.error),this.error=(null==e?void 0:e.message)||wp.i18n.__("Something went wrong","surecart")}finally{this.busy=!1}}async getItems(){const e=await await fetch.apiFetch({path:addQueryArgs.addQueryArgs("surecart/v1/purchases/",{expand:["product","product.downloads","download.media"],downloadable:!0,revoked:!1,...this.query}),parse:!1});return this.pagination={total:parseInt(e.headers.get("X-WP-Total")),total_pages:parseInt(e.headers.get("X-WP-TotalPages"))},this.purchases=await e.json(),this.purchases}nextPage(){this.query.page=this.query.page+1,this.fetchItems()}prevPage(){this.query.page=this.query.page-1,this.fetchItems()}render(){var e;return index.h("sc-purchase-downloads-list",{heading:this.heading,allLink:this.allLink&&this.pagination.total_pages>1?this.allLink:"",loading:this.loading,busy:this.busy,requestNonce:this.requestNonce,error:this.error,purchases:this.purchases},index.h("span",{slot:"heading"},index.h("slot",{name:"heading"},this.heading||wp.i18n.__("Downloads","surecart"))),index.h("sc-pagination",{slot:"after",page:this.query.page,perPage:this.query.per_page,total:this.pagination.total,totalPages:this.pagination.total_pages,totalShowing:null===(e=null==this?void 0:this.purchases)||void 0===e?void 0:e.length,onScNextPage:()=>this.nextPage(),onScPrevPage:()=>this.prevPage()}))}get el(){return index.getElement(this)}};ScDownloadsList.style=scDashboardDownloadsListCss,exports.sc_dashboard_downloads_list=ScDownloadsList;