import{Component,Event,h,Prop}from"@stencil/core";import{sprintf,__}from"@wordpress/i18n";import{isBumpInOrder}from"../../../../functions/line-items";import{intervalString}from"../../../../functions/price";export class ScOrderBump{updateLineItem(e){var t,i,o;const r=(null===(t=this.bump.price)||void 0===t?void 0:t.id)||(null===(i=this.bump)||void 0===i?void 0:i.price);e?this.scAddLineItem.emit({bump:null===(o=this.bump)||void 0===o?void 0:o.id,price_id:r,quantity:1}):this.scRemoveLineItem.emit({price_id:r,quantity:1})}newPrice(){var e,t,i,o,r,n;let s=null,l=(null===(t=null===(e=this.bump)||void 0===e?void 0:e.price)||void 0===t?void 0:t.amount)||0;if((null===(i=this.bump)||void 0===i?void 0:i.amount_off)&&(s=Math.max(0,l-(null===(o=this.bump)||void 0===o?void 0:o.amount_off))),null===(r=this.bump)||void 0===r?void 0:r.percent_off){const e=l*((null===(n=this.bump)||void 0===n?void 0:n.percent_off)/100);s=Math.max(0,l-e)}return s}renderInterval(){var e;const t=intervalString(null===(e=this.bump)||void 0===e?void 0:e.price,{labels:{interval:"/",period:__("for","surecart")}});return t.trim().length?h("span",{class:"bump__interval"},t):null}renderPrice(){var e,t,i,o,r,n,s;return h("div",{slot:"description",class:{bump__price:!0,"bump__price--has-discount":!!(null===(e=this.bump)||void 0===e?void 0:e.percent_off)||!!(null===(t=this.bump)||void 0===t?void 0:t.amount_off)},part:"price"},h("sc-format-number",{type:"currency",class:"bump__original-price",value:null===(o=null===(i=this.bump)||void 0===i?void 0:i.price)||void 0===o?void 0:o.amount,currency:null===(n=null===(r=this.bump)||void 0===r?void 0:r.price)||void 0===n?void 0:n.currency})," ",0===this.newPrice()&&__("Free","surecart"),null!==this.newPrice()&&this.newPrice()>0&&h("sc-format-number",{type:"currency",class:"bump__new-price",value:this.newPrice(),currency:(null===(s=this.bump)||void 0===s?void 0:s.price).currency}),this.renderInterval())}renderDiscount(){var e,t,i,o,r;return(null===(e=this.bump)||void 0===e?void 0:e.amount_off)?h("div",{class:"bump__tag"},__("Save","surecart")," ",h("sc-format-number",{type:"currency",value:-(null===(t=this.bump)||void 0===t?void 0:t.amount_off),currency:(null===(i=this.bump)||void 0===i?void 0:i.price).currency})):(null===(o=this.bump)||void 0===o?void 0:o.percent_off)?h("div",{class:"bump__tag"},sprintf(__("Save %s%%","surecart"),null===(r=this.bump)||void 0===r?void 0:r.percent_off)):void 0}render(){var e,t,i,o,r,n,s,l,u,c,d,a,p,m;const v=null===(t=null===(e=this.bump)||void 0===e?void 0:e.price)||void 0===t?void 0:t.product;return h("sc-choice",{value:null===(i=this.bump)||void 0===i?void 0:i.id,type:"checkbox",showControl:this.showControl,checked:isBumpInOrder(this.bump,this.checkout),onScChange:e=>this.updateLineItem(e.target.checked),exportparts:"base, control, checked-icon, title"},h("div",{part:"base-content",class:"bump"},h("div",{class:"bump__text"},h("div",{class:"bump__title"},(null===(r=null===(o=this.bump)||void 0===o?void 0:o.metadata)||void 0===r?void 0:r.cta)||(null===(n=this.bump)||void 0===n?void 0:n.name)||(null==v?void 0:v.name)),h("div",{class:"bump__amount"},this.renderPrice()," ",this.renderDiscount()))),(null===(l=null===(s=this.bump)||void 0===s?void 0:s.metadata)||void 0===l?void 0:l.description)&&h("div",{slot:"footer"},h("sc-divider",{style:{"--spacing":"var(--sc-spacing-medium)"}}),h("div",{class:"bump__product"},!!(null==v?void 0:v.image_url)&&h("img",{src:v.image_url,class:"bump__image"}),h("div",{class:"bump__product-text"},!!(null===(c=null===(u=this.bump)||void 0===u?void 0:u.metadata)||void 0===c?void 0:c.cta)&&h("div",{class:"bump__product-title"},this.bump.name||(null==v?void 0:v.name)),!!(null===(a=null===(d=this.bump)||void 0===d?void 0:d.metadata)||void 0===a?void 0:a.description)&&h("div",{class:"bump__product-description"},null===(m=null===(p=this.bump)||void 0===p?void 0:p.metadata)||void 0===m?void 0:m.description)))))}static get is(){return"sc-order-bump"}static get encapsulation(){return"shadow"}static get originalStyleUrls(){return{$:["sc-order-bump.scss"]}}static get styleUrls(){return{$:["sc-order-bump.css"]}}static get properties(){return{bump:{type:"unknown",mutable:!1,complexType:{original:"Bump",resolved:"Bump",references:{Bump:{location:"import",path:"../../../../types"}}},required:!1,optional:!1,docs:{tags:[],text:"The bump"}},checkout:{type:"unknown",mutable:!1,complexType:{original:"Checkout",resolved:"Checkout",references:{Checkout:{location:"import",path:"../../../../types"}}},required:!1,optional:!1,docs:{tags:[],text:"The checkout"}},showControl:{type:"boolean",mutable:!1,complexType:{original:"boolean",resolved:"boolean",references:{}},required:!1,optional:!1,docs:{tags:[],text:"Should we show the controls"},attribute:"show-control",reflect:!0}}}static get events(){return[{method:"scAddLineItem",name:"scAddLineItem",bubbles:!0,cancelable:!0,composed:!0,docs:{tags:[],text:"Add line item event"},complexType:{original:"LineItemData",resolved:"LineItemData",references:{LineItemData:{location:"import",path:"../../../../types"}}}},{method:"scRemoveLineItem",name:"scRemoveLineItem",bubbles:!0,cancelable:!0,composed:!0,docs:{tags:[],text:"Remove line item event"},complexType:{original:"LineItemData",resolved:"LineItemData",references:{LineItemData:{location:"import",path:"../../../../types"}}}}]}}