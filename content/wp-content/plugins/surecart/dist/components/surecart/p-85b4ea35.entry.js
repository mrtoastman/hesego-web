import{r as t,c as i,h as n,F as r,H as e}from"./p-dfbe004d.js";import{o}from"./p-d63f2554.js";import{i as c}from"./p-afcbd440.js";import{i as s}from"./p-468023a1.js";import{a as u}from"./p-d8453138.js";import{a as h}from"./p-1c2e2695.js";function a(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function d(e,t,i){return t&&a(e.prototype,t),i&&a(e,i),e}function l(){return(l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}function p(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function v(e){return!(!e||"function"!=typeof e.hasOwnProperty||!(e.hasOwnProperty("__ownerID")||e._map&&e._map.hasOwnProperty("__ownerID")))}function f(e,t,i){return Object.keys(e).reduce((function(t,n){var r=""+n;return t.has(r)?t.set(r,i(t.get(r),e[r])):t}),t)}var m=function(){function e(e,t,i){if(void 0===t&&(t={}),void 0===i&&(i={}),!e||"string"!=typeof e)throw new Error("Expected a string key for Entity, but found "+e+".");var n=i.idAttribute,r=void 0===n?"id":n,c=i.mergeStrategy,o=void 0===c?function(e,t){return l({},e,t)}:c,s=i.processStrategy,a=void 0===s?function(e){return l({},e)}:s,u=i.fallbackStrategy,h=void 0===u?function(){}:u;this._key=e,this._getId="function"==typeof r?r:function(e){return function(t){return v(t)?t.get(e):t[e]}}(r),this._idAttribute=r,this._mergeStrategy=o,this._processStrategy=a,this._fallbackStrategy=h,this.define(t)}var t=e.prototype;return t.define=function(e){this.schema=Object.keys(e).reduce((function(t,i){var n;return l({},t,((n={})[i]=e[i],n))}),this.schema||{})},t.getId=function(e,t,i){return this._getId(e,t,i)},t.merge=function(e,t){return this._mergeStrategy(e,t)},t.fallback=function(e,t){return this._fallbackStrategy(e,t)},t.normalize=function(e,t,i,n,r,c){var o=this,s=this.getId(e,t,i),a=this.key;if(a in c||(c[a]={}),s in c[a]||(c[a][s]=[]),c[a][s].some((function(t){return t===e})))return s;c[a][s].push(e);var u=this._processStrategy(e,t,i);return Object.keys(this.schema).forEach((function(t){if(u.hasOwnProperty(t)&&"object"==typeof u[t]){var i=o.schema[t],s="function"==typeof i?i(e):i;u[t]=n(u[t],u,t,s,r,c)}})),r(this,u,e,t,i),s},t.denormalize=function(e,t){var i=this;return v(e)?f(this.schema,e,t):(Object.keys(this.schema).forEach((function(n){e.hasOwnProperty(n)&&(e[n]=t(e[n],i.schema[n]))})),e)},d(e,[{key:"key",get:function(){return this._key}},{key:"idAttribute",get:function(){return this._idAttribute}}]),e}(),g=function(){function e(e,t){t&&(this._schemaAttribute="string"==typeof t?function(e){return e[t]}:t),this.define(e)}var t=e.prototype;return t.define=function(e){this.schema=e},t.getSchemaAttribute=function(e,t,i){return!this.isSingleSchema&&this._schemaAttribute(e,t,i)},t.inferSchema=function(e,t,i){if(this.isSingleSchema)return this.schema;var n=this.getSchemaAttribute(e,t,i);return this.schema[n]},t.normalizeValue=function(e,t,i,n,r,c){var o=this.inferSchema(e,t,i);if(!o)return e;var s=n(e,t,i,o,r,c);return this.isSingleSchema||null==s?s:{id:s,schema:this.getSchemaAttribute(e,t,i)}},t.denormalizeValue=function(e,t){var i=v(e)?e.get("schema"):e.schema;return this.isSingleSchema||i?t((this.isSingleSchema?void 0:v(e)?e.get("id"):e.id)||e,this.isSingleSchema?this.schema:this.schema[i]):e},d(e,[{key:"isSingleSchema",get:function(){return!this._schemaAttribute}}]),e}(),w=function(e){function t(t,i){if(!i)throw new Error('Expected option "schemaAttribute" not found on UnionSchema.');return e.call(this,t,i)||this}p(t,e);var i=t.prototype;return i.normalize=function(e,t,i,n,r,c){return this.normalizeValue(e,t,i,n,r,c)},i.denormalize=function(e,t){return this.denormalizeValue(e,t)},t}(g),y=function(e){function t(){return e.apply(this,arguments)||this}p(t,e);var i=t.prototype;return i.normalize=function(e,t,i,n,r,c){var o=this;return Object.keys(e).reduce((function(t,i){var s,a=e[i];return null!=a?l({},t,((s={})[i]=o.normalizeValue(a,e,i,n,r,c),s)):t}),{})},i.denormalize=function(e,t){var i=this;return Object.keys(e).reduce((function(n,r){var c;return l({},n,((c={})[r]=i.denormalizeValue(e[r],t),c))}),{})},t}(g),b=function(e){return Array.isArray(e)?e:Object.keys(e).map((function(t){return e[t]}))},_=function(e,t,i,n,r,c,o){return e=function(e){if(Array.isArray(e)&&e.length>1)throw new Error("Expected schema definition to be a single schema, but found "+e.length+".");return e[0]}(e),b(t).map((function(t){return r(t,i,n,e,c,o)}))},j=function(e){function t(){return e.apply(this,arguments)||this}p(t,e);var i=t.prototype;return i.normalize=function(e,t,i,n,r,c){var o=this;return b(e).map((function(e){return o.normalizeValue(e,t,i,n,r,c)})).filter((function(e){return null!=e}))},i.denormalize=function(e,t){var i=this;return e&&e.map?e.map((function(e){return i.denormalizeValue(e,t)})):e},t}(g),x=function(e,t,i,n,r,c,o){var s=l({},t);return Object.keys(e).forEach((function(i){var n=e[i],a="function"==typeof n?n(t):n,u=r(t[i],t,i,a,c,o);null==u?delete s[i]:s[i]=u})),s},O=function(e,t,i){if(v(t))return f(e,t,i);var n=l({},t);return Object.keys(e).forEach((function(t){null!=n[t]&&(n[t]=i(n[t],e[t]))})),n},C=function e(t,i,n,r,c,o){return"object"==typeof t&&t?"object"!=typeof r||r.normalize&&"function"==typeof r.normalize?r.normalize(t,i,n,e,c,o):(Array.isArray(r)?_:x)(r,t,i,n,e,c,o):t},k={Array:j,Entity:m,Object:function(){function e(e){this.define(e)}var t=e.prototype;return t.define=function(e){this.schema=Object.keys(e).reduce((function(t,i){var n;return l({},t,((n={})[i]=e[i],n))}),this.schema||{})},t.normalize=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return x.apply(void 0,[this.schema].concat(t))},t.denormalize=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return O.apply(void 0,[this.schema].concat(t))},e}(),Union:w,Values:y};const E={integration:new k.Entity("integration"),account:new k.Entity("account"),price:new k.Entity("price"),product:new k.Entity("product"),product_group:new k.Entity("product_group"),purchase:new k.Entity("purchase"),payment_method:new k.Entity("payment_method"),card:new k.Entity("card"),invoice:new k.Entity("invoice"),current_period:new k.Entity("current_period"),refund:new k.Entity("refund"),charge:new k.Entity("charge"),coupon:new k.Entity("coupon"),promotion:new k.Entity("promotion"),order:new k.Entity("order"),customer:new k.Entity("customer"),subscription:new k.Entity("subscription"),product_group:new k.Entity("product_group")},{price:A,product:P,purchase:I,payment_method:z,card:S,invoice:L,refund:U,charge:H,coupon:D,promotion:F,order:T,integration:W,customer:q,product_group:R,subscription:V}=E;P.define({prices:{data:[A]},product_group:R}),A.define({product:P}),L.define({purchases:{data:[I]},charge:H,customer:q,subscription:V}),T.define({purchases:{data:[I]},charge:H,customer:q,subscription:V}),H.define({order:T,invoice:L}),V.define({current_period:L,purchase:I,price:A,payment_method:z,order:T,customer:q}),U.define({charge:H,customer:q}),I.define({order:T,product:P,subscription:V}),z.define({card:S}),D.define({promotions:{data:[F]}}),R.define({}),W.define({});const B=e=>E?.[e?.[0]?.object]?function(e,t){if(!e||"object"!=typeof e)throw new Error('Unexpected input given to normalize. Expected type to be "object", found "'+(null===e?"null":typeof e)+'".');var i={},n=function(e){return function(t,i,n,r,c){var o=t.key,s=t.getId(n,r,c);o in e||(e[o]={});var a=e[o][s];e[o][s]=a?t.merge(a,i):i}}(i);return{entities:i,result:C(e,e,null,t,n,{})}}(e,[E[e?.[0]?.object]]):{},G=class{constructor(e){t(this,e),this.scUpdateLineItem=i(this,"scUpdateLineItem",7),this.scRemoveLineItem=i(this,"scRemoveLineItem",7),this.scAddEntities=i(this,"scAddEntities",7),this.loading=!1,this.showLabel=!0,this.showPrice=!0,this.showControl=!0,this.prices={},this.products={},this.quantity=1,this.checked=!1,this.blank=!1}handlePriceIdChage(){var e;this.price&&(null===(e=this.price)||void 0===e?void 0:e.id)===this.priceId||this.fetchPriceWithProduct()}handlePricesChange(){var e,t,i;Object.keys(this.prices||{}).length&&Object.keys(this.products||{}).length&&(this.price=null===(e=null==this?void 0:this.prices)||void 0===e?void 0:e[this.priceId],this.product=null===(t=null==this?void 0:this.products)||void 0===t?void 0:t[null===(i=null==this?void 0:this.price)||void 0===i?void 0:i.product])}handlePriseChange(){var e;this.isAdHoc=null===(e=null==this?void 0:this.price)||void 0===e?void 0:e.ad_hoc}handleErrorsChange(){var e;const t=((null===(e=null==this?void 0:this.error)||void 0===e?void 0:e.additional_errors)||[]).find((e=>{var t;return"line_items.ad_hoc_amount"===(null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.attribute)}));this.adHocErrorMessage=(null==t?void 0:t.message)?null==t?void 0:t.message:""}handleCheckedChange(){var e;(null===(e=this.price)||void 0===e?void 0:e.ad_hoc)&&this.choice.checked&&setTimeout((()=>{this.adHocInput.triggerFocus()}),50)}componentWillLoad(){this.price||this.fetchPriceWithProduct()}async fetchPriceWithProduct(){if(this.priceId)try{this.loading=!0;const{products:e,prices:t}=await(async({ids:e,archived:t=!1})=>(e=>{const{entities:t}=B(e);return{prices:null==t?void 0:t.price,products:null==t?void 0:t.product}})(await u({path:h("surecart/v1/prices/",{ids:e,archived:t,expand:["product"]})})))({archived:!1,ids:[this.priceId]});this.scAddEntities.emit({prices:t,products:e})}catch(e){}finally{this.loading=!1}}isInOrder(){return c(this.price,this.order)}isChecked(){return this.isInOrder()}onChangeAdHoc(e){this.scUpdateLineItem.emit({price_id:this.priceId,quantity:this.quantity,ad_hoc_amount:e.target.value})}getLineItem(){var e,t;return((null===(t=null===(e=this.order)||void 0===e?void 0:e.line_items)||void 0===t?void 0:t.data)||[]).find((e=>e.price.id===this.priceId))}showAdHoc(){var e,t;return!!(null===(e=this.price)||void 0===e?void 0:e.ad_hoc)&&(!!this.isInOrder()||(null===(t=null==this?void 0:this.choice)||void 0===t?void 0:t.checked))}renderEmpty(){var t;return(null===(t=null===window||void 0===window?void 0:window.wp)||void 0===t?void 0:t.blocks)?n("sc-alert",{type:"danger",open:!0,style:{margin:"0px"}},wp.i18n.__("This product has been archived.","surecart")):n(e,{style:{display:"none"}})}renderPrice(){return n(r,null,n("sc-format-number",{type:"currency",value:this.price.amount,currency:this.price.currency}),s(this.price,{showOnce:!0,abbreviate:!0,labels:{interval:"/",period:wp.i18n.__("for","surecart")}}))}render(){var e,t,i,c,o,a,u;return this.loading?n("sc-choice-container",{showControl:this.showControl,name:"loading",disabled:!0},n("div",{class:"price-choice"},n("sc-skeleton",{style:{width:"60px",display:"inline-block"}}),n("sc-skeleton",{style:{width:"80px",display:"inline-block"}}))):!(null===(e=null==this?void 0:this.price)||void 0===e?void 0:e.id)||(null===(t=this.price)||void 0===t?void 0:t.archived)||(null===(i=this.product)||void 0===i?void 0:i.archived)?this.renderEmpty():n("sc-choice-container",{ref:e=>this.choice=e,value:this.priceId,type:this.type,showControl:this.showControl,checked:this.isChecked()},n("div",{class:"price-choice"},this.showLabel&&n("div",{class:"price-choice__title"},n("div",{class:"price-choice__name"},this.label||(null===(c=null==this?void 0:this.price)||void 0===c?void 0:c.name)||(null===(o=null==this?void 0:this.product)||void 0===o?void 0:o.name)),!!this.description&&n("div",{class:"price-choice__description"},this.description)),this.showPrice&&n("div",{class:"price-choice__details"},n("div",{class:"price-choice__price"},(null===(a=this.price)||void 0===a?void 0:a.ad_hoc)?wp.i18n.__("Custom Amount","surecart"):n(r,null,n("sc-format-number",{type:"currency",value:this.price.amount,currency:this.price.currency}),s(this.price,{showOnce:!0,abbreviate:!0,labels:{interval:"/",period:wp.i18n.__("for","surecart")}}))),!!this.price.trial_duration_days&&n("div",{class:"price-choice__trial"},wp.i18n.sprintf(wp.i18n._n("Starting in %s day","Starting in %s days",this.price.trial_duration_days,"surecart"),this.price.trial_duration_days)),!!this.price.setup_fee_enabled&&(null===(u=this.price)||void 0===u?void 0:u.setup_fee_amount)&&n("div",{class:"price-choice__setup-fee"},n("sc-format-number",{type:"currency",value:this.price.setup_fee_amount,currency:this.price.currency})," ",this.price.setup_fee_name||wp.i18n.__("Setup Fee","surecart")))))}static get watchers(){return{priceId:["handlePriceIdChage"],prices:["handlePricesChange"],products:["handlePricesChange"],price:["handlePriseChange"],error:["handleErrorsChange"],checked:["handleCheckedChange"]}}};o(G,["prices","products","order","error"],!1),G.style=":host {\n  display: block;\n  min-width: 0;\n  width: 100%;\n}\n\nsc-choice-container {\n  container-type: inline-size;\n}\n\n.price-choice {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  line-height: var(--sc-line-height-dense);\n  gap: var(--sc-spacing-small);\n}\n.price-choice__name {\n  display: inline-block;\n  color: var(--sc-price-choice-name-color, var(--sc-input-label-color));\n  font-size: var(--sc-price-choice-name-size, var(--sc-input-label-font-size-medium));\n  font-weight: var(--sc-price-choice-name-font-weight, var(--sc-font-weight-bold));\n  text-transform: var(--sc-price-choice-text-transform, var(--sc-input-label-text-transform, none));\n}\n.price-choice__description {\n  color: var(--sc-input-help-text-color);\n}\n.price-choice > *:not(:first-child):last-child {\n  text-align: right;\n}\n.price-choice__details {\n  flex: 1 0 50%;\n  display: grid;\n  gap: var(--sc-spacing-xxx-small);\n}\n.price-choice__trial, .price-choice__setup-fee, .price-choice__price {\n  font-size: var(--sc-font-size-small);\n  color: var(--sc-input-help-text-color);\n}\n.price-choice__price {\n  color: var(--sc-input-label-color);\n  font-weight: var(--sc-price-choice-price-font-weight, var(--sc-font-weight-normal));\n}\n\n@container (max-width: 325px) {\n  .price-choice {\n    flex-direction: column;\n    align-items: flex-start;\n    gap: var(--sc-spacing-xx-small);\n  }\n  .price-choice > *:not(:first-child):last-child {\n    text-align: initial;\n  }\n}";export{G as sc_price_choice};